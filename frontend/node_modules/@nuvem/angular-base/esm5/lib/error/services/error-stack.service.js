import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { HttpGenericErrorService } from '../services/http-generic-error.service';
import * as i0 from "@angular/core";
import * as i1 from "./http-generic-error.service";
/**
 * Serviço de erros ErrorStackService
 * @class
 */
import * as ɵngcc0 from '@angular/core';
var ErrorStackService = /** @class */ (function () {
    /**
     * metodo construtor injeta serviço generico de erros
     * @param {HttpGenericErrorService} genericErrorService
     * @constructor
     */
    function ErrorStackService(genericErrorService) {
        var _this = this;
        this.genericErrorService = genericErrorService;
        /**
         * Propriedade errors
         * @type {ReplaySubject<NamedErrorType>}
         */
        this.errors = new ReplaySubject();
        if (null === localStorage.getItem('errorStack')) {
            localStorage.setItem('errorStack', JSON.stringify([]));
        }
        this.getErrorsSubjects().forEach(function (error) {
            _this.errors.next(error);
        });
    }
    /**
     * Metodo responsável por criar erro do tipo HttpResponse
     * @param {HttpErrorResponse} error
     * @returns void
     */
    ErrorStackService.prototype.create = function (error) {
        var namedError = this.createNamedError(error);
        var persistedErrors = this.getErrorsSubjects();
        if (persistedErrors.length >= 15) {
            persistedErrors.shift();
        }
        persistedErrors.push(namedError);
        localStorage.setItem('errorStack', JSON.stringify(persistedErrors));
        this.errors.next(namedError);
    };
    /**
     * Metodo responsável por obter o conteúdo dos erros emitidos
     * @private
     * @returns NamedErrorType[]
     */
    ErrorStackService.prototype.getErrorsSubjects = function () {
        return JSON.parse(localStorage.getItem('errorStack'));
    };
    /**
     * Metodo responsável por itentifica o tipo de erro lançado
     * @private
     * @param {HttpErrorResponse} error
     * @returns NamedErrorType
     */
    ErrorStackService.prototype.createNamedError = function (error) {
        var fullMessage;
        var namedError;
        var createdAt = new Date();
        var errorId = this.getErrorId(error);
        var title;
        if (error.headers.get('Content-Type') === 'application/problem+json') {
            fullMessage = "X-Correlation-ID: " + errorId + "\n                           createdAt: " + createdAt + "\n                           status: " + error.status + "\n                           url: " + error.url + "\n                           body: " + error.error.detail + "\n                           stacktrace: " + error.error.stacktrace + "\n                           cause: " + error.error.cause;
            title = error.error.title;
        }
        else {
            var genericError = this.genericErrorService.getErrorByCode(error);
            fullMessage = "X-Correlation-ID: " + errorId + "\n                           createdAt: " + createdAt + "\n                           status: " + error.status + "\n                           url: " + error.url + "\n                           body: " + genericError.detail;
            title = genericError.title;
        }
        namedError = {
            message: title,
            createdAt: createdAt,
            correlationId: errorId,
            fullMessage: fullMessage
        };
        return namedError;
    };
    /**
     * Metodo responsável por obter o identificador do erro
     * @private
     * @param {HttpErrorResponse} error
     * @returns string
     */
    ErrorStackService.prototype.getErrorId = function (error) {
        var errorKey;
        error.headers.keys().every(function (key) {
            if (key.toUpperCase() === 'X-CORRELATION-ID') {
                errorKey = key;
                return false;
            }
            return true;
        });
        return errorKey ? error.headers.get(errorKey) : null;
    };
    ErrorStackService.ctorParameters = function () { return [
        { type: HttpGenericErrorService }
    ]; };
    ErrorStackService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ErrorStackService_Factory() { return new ErrorStackService(i0.ɵɵinject(i1.HttpGenericErrorService)); }, token: ErrorStackService, providedIn: "root" });
ErrorStackService.ɵfac = function ErrorStackService_Factory(t) { return new (t || ErrorStackService)(ɵngcc0.ɵɵinject(HttpGenericErrorService)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ErrorStackService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: HttpGenericErrorService }]; }, null); })();
    return ErrorStackService;
}());
export { ErrorStackService };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3Itc3RhY2suc2VydmljZS5qcyIsInNvdXJjZXMiOlsibmc6L0BudXZlbS9hbmd1bGFyLWJhc2UvbGliL2Vycm9yL3NlcnZpY2VzL2Vycm9yLXN0YWNrLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUdyQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNqRjtBQUVnQztBQURoQztBQUNBO0FBQ0E7QUFBVSxHQUNQOztBQUlIO0FBR1csSUFLUDtBQUNKO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxJQUFJLDJCQUFvQixtQkFBNEM7QUFDcEUsUUFESSxpQkFRQztBQUNMLFFBVHdCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBeUI7QUFBQyxRQVhqRTtBQUNKO0FBQ0k7QUFFSixXQURPO0FBQ1AsUUFBSSxXQUFNLEdBQWtDLElBQUksYUFBYSxFQUFrQixDQUFDO0FBQ2hGLFFBT1EsSUFBSSxJQUFJLEtBQUssWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRTtBQUN6RCxZQUFZLFlBQVksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNuRSxTQUFTO0FBQ1QsUUFDUSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBQyxLQUFxQjtBQUFJLFlBQ3ZELEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3BDLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDWCxJQUFJLENBQUM7QUFDTCxJQUNJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLElBQUksa0NBQU0sR0FBTixVQUFPLEtBQXdCO0FBQ25DLFFBQVEsSUFBTSxVQUFV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QUM7QUFDL0IsZ0JBQWdCLE9BQU8sS0FBSyxDQUFDO0FBQzdCLGFBQWE7QUFDYixZQUFZLE9BQU8sSUFBSSxDQUFDO0FBQ3hCLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDWCxRQUNRLE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzdELElBQUksQ0FBQztBQUVMO0FBQzRELGdCQTNHZix1QkFBdUI7QUFBRztBQUM5RDtJQWRJLGlCQUFpQix3QkFIN0IsVUFBVSxDQUFDLGNBQ1IsVUFBVSxFQUFFLE1BQU0sV0FDckIsQ0FBQyxRQUNXLGlCQUFpQixDQXVIN0I7Ozs7OztpRkFDRDtBQUFDLDRCQXJJRDtBQUFFLENBb0lELEFBdkhELElBdUhDO0FBQ0QsU0F4SGEsaUJBQWlCO0FBRTlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTmFtZWRFcnJvclR5cGUgfSBmcm9tICcuLi90eXBlcy9uYW1lZC1lcnJvci50eXBlJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSHR0cEdlbmVyaWNFcnJvclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9odHRwLWdlbmVyaWMtZXJyb3Iuc2VydmljZSc7XG5cbi8qKlxuICogU2VydmnDp28gZGUgZXJyb3MgRXJyb3JTdGFja1NlcnZpY2VcbiAqIEBjbGFzcyBcbiAqL1xuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgRXJyb3JTdGFja1NlcnZpY2Uge1xuXG4gICAgLyoqXG4gICAgICogUHJvcHJpZWRhZGUgZXJyb3JzXG4gICAgICogQHR5cGUge1JlcGxheVN1YmplY3Q8TmFtZWRFcnJvclR5cGU+fVxuICAgICAqL1xuICAgIGVycm9yczogUmVwbGF5U3ViamVjdDxOYW1lZEVycm9yVHlwZT4gPSBuZXcgUmVwbGF5U3ViamVjdDxOYW1lZEVycm9yVHlwZT4oKTtcblxuICAgIC8qKlxuICAgICAqIG1ldG9kbyBjb25zdHJ1dG9yIGluamV0YSBzZXJ2acOnbyBnZW5lcmljbyBkZSBlcnJvc1xuICAgICAqIEBwYXJhbSB7SHR0cEdlbmVyaWNFcnJvclNlcnZpY2V9IGdlbmVyaWNFcnJvclNlcnZpY2VcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdlbmVyaWNFcnJvclNlcnZpY2U6IEh0dHBHZW5lcmljRXJyb3JTZXJ2aWNlKSB7XG4gICAgICAgIGlmIChudWxsID09PSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZXJyb3JTdGFjaycpKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZXJyb3JTdGFjaycsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmdldEVycm9yc1N1YmplY3RzKCkuZm9yRWFjaCgoZXJyb3I6IE5hbWVkRXJyb3JUeXBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycy5uZXh0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIHJlc3BvbnPDoXZlbCBwb3IgY3JpYXIgZXJybyBkbyB0aXBvIEh0dHBSZXNwb25zZVxuICAgICAqIEBwYXJhbSB7SHR0cEVycm9yUmVzcG9uc2V9IGVycm9yXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIGNyZWF0ZShlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICAgICAgY29uc3QgbmFtZWRFcnJvciA9IHRoaXMuY3JlYXRlTmFtZWRFcnJvcihlcnJvcik7XG5cbiAgICAgICAgY29uc3QgcGVyc2lzdGVkRXJyb3JzOiBOYW1lZEVycm9yVHlwZVtdID0gdGhpcy5nZXRFcnJvcnNTdWJqZWN0cygpO1xuXG4gICAgICAgIGlmIChwZXJzaXN0ZWRFcnJvcnMubGVuZ3RoID49IDE1KSB7XG4gICAgICAgICAgICBwZXJzaXN0ZWRFcnJvcnMuc2hpZnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBlcnNpc3RlZEVycm9ycy5wdXNoKG5hbWVkRXJyb3IpO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdlcnJvclN0YWNrJywgSlNPTi5zdHJpbmdpZnkocGVyc2lzdGVkRXJyb3JzKSk7XG5cbiAgICAgICAgdGhpcy5lcnJvcnMubmV4dChuYW1lZEVycm9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gcmVzcG9uc8OhdmVsIHBvciBvYnRlciBvIGNvbnRlw7pkbyBkb3MgZXJyb3MgZW1pdGlkb3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm5zIE5hbWVkRXJyb3JUeXBlW11cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEVycm9yc1N1YmplY3RzKCk6IE5hbWVkRXJyb3JUeXBlW10ge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZXJyb3JTdGFjaycpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gcmVzcG9uc8OhdmVsIHBvciBpdGVudGlmaWNhIG8gdGlwbyBkZSBlcnJvIGxhbsOnYWRvXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0h0dHBFcnJvclJlc3BvbnNlfSBlcnJvclxuICAgICAqIEByZXR1cm5zIE5hbWVkRXJyb3JUeXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBjcmVhdGVOYW1lZEVycm9yKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSk6IE5hbWVkRXJyb3JUeXBlIHtcbiAgICAgICAgbGV0IGZ1bGxNZXNzYWdlOiBzdHJpbmc7XG4gICAgICAgIGxldCBuYW1lZEVycm9yOiBOYW1lZEVycm9yVHlwZTtcbiAgICAgICAgbGV0IGNyZWF0ZWRBdDogRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGxldCBlcnJvcklkID0gdGhpcy5nZXRFcnJvcklkKGVycm9yKTtcbiAgICAgICAgbGV0IHRpdGxlOiBzdHJpbmcgfCBudWxsO1xuXG4gICAgICAgIGlmIChlcnJvci5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgPT09ICdhcHBsaWNhdGlvbi9wcm9ibGVtK2pzb24nKSB7XG4gICAgICAgICAgICBmdWxsTWVzc2FnZSA9IGBYLUNvcnJlbGF0aW9uLUlEOiAke2Vycm9ySWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6ICR7Y3JlYXRlZEF0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAke2Vycm9yLnN0YXR1c31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJHtlcnJvci51cmx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiAke2Vycm9yLmVycm9yLmRldGFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrdHJhY2U6ICR7ZXJyb3IuZXJyb3Iuc3RhY2t0cmFjZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiAke2Vycm9yLmVycm9yLmNhdXNlfWA7XG5cbiAgICAgICAgICAgIHRpdGxlID0gZXJyb3IuZXJyb3IudGl0bGU7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyaWNFcnJvciA9IHRoaXMuZ2VuZXJpY0Vycm9yU2VydmljZS5nZXRFcnJvckJ5Q29kZShlcnJvcik7XG5cbiAgICAgICAgICAgIGZ1bGxNZXNzYWdlID0gYFgtQ29ycmVsYXRpb24tSUQ6ICR7ZXJyb3JJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogJHtjcmVhdGVkQXR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICR7ZXJyb3Iuc3RhdHVzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAke2Vycm9yLnVybH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6ICR7Z2VuZXJpY0Vycm9yLmRldGFpbH1gO1xuXG4gICAgICAgICAgICB0aXRsZSA9IGdlbmVyaWNFcnJvci50aXRsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5hbWVkRXJyb3IgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiB0aXRsZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogY3JlYXRlZEF0LFxuICAgICAgICAgICAgY29ycmVsYXRpb25JZDogZXJyb3JJZCxcbiAgICAgICAgICAgIGZ1bGxNZXNzYWdlOiBmdWxsTWVzc2FnZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBuYW1lZEVycm9yO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ldG9kbyByZXNwb25zw6F2ZWwgcG9yIG9idGVyIG8gaWRlbnRpZmljYWRvciBkbyBlcnJvXG4gICAgICogQHByaXZhdGUgXG4gICAgICogQHBhcmFtIHtIdHRwRXJyb3JSZXNwb25zZX0gZXJyb3JcbiAgICAgKiBAcmV0dXJucyBzdHJpbmdcbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEVycm9ySWQoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGVycm9yS2V5OiBzdHJpbmcgfCBudWxsO1xuXG4gICAgICAgIGVycm9yLmhlYWRlcnMua2V5cygpLmV2ZXJ5KGtleSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5LnRvVXBwZXJDYXNlKCkgPT09ICdYLUNPUlJFTEFUSU9OLUlEJykge1xuICAgICAgICAgICAgICAgIGVycm9yS2V5ID0ga2V5O1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZXJyb3JLZXkgPyBlcnJvci5oZWFkZXJzLmdldChlcnJvcktleSkgOiBudWxsO1xuICAgIH1cblxufVxuIl19