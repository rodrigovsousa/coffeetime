/**
 * Class ServerDataProvider
 * @class
 */
export class ServerDataProvider {
    /**
     * constructor method
     * @constructor
     * @param {DatatableService} datatableService
     * @param {DatatableComponent} component
     */
    constructor(datatableService, component) {
        this.datatableService = datatableService;
        this.component = component;
        this.component.pDatatableComponent.onLazyLoad.subscribe((event) => this.onLazyLoad(event));
        this.component.pDatatableComponent.lazy = true;
    }
    /**
     * onLazyLoad method
     * @param {LazyLoadEvent} onLazyLoad
     * @returns void
     */
    onLazyLoad(event) {
        this.currentLazyLoadEvent = event;
        this.load();
    }
    /**
     * load method
     * @param {any} query
     * @returns void
     */
    load(query) {
        query = this.retrieveAndSaveQuery(query);
        this.component.startedLoading.emit();
        this.datatableService.search(this.currentLazyLoadEvent, this.component.url, this.component.pDatatableComponent.rows, this.component.orderInSort, query)
            .toPromise()
            .then((response) => {
            this.treatLoadResponse(response);
            this.component.finishedLoading.emit();
        }, (error) => {
            this.component.finishedLoading.emit(error);
        });
    }
    /**
     * treatLoadResponse method
     * @param {any} response
     * @return void
     */
    treatLoadResponse(response) {
        const data = response.body;
        if (this.component.paginationParameters) {
            this.treatLoadResponseWithPaginationParameters(data);
        }
        else {
            this.treatLoadResponseWithoutPaginationParameters(response, data);
        }
    }
    /**
     * treatLoadResponseWithPaginationParameters method
     * @param {any} data
     * @returns void
     */
    treatLoadResponseWithPaginationParameters(data) {
        let contentIndex = this.component.paginationParameters.contentIndex;
        let totalIndex = this.component.paginationParameters.totalElementsIndex;
        this.component.value = (data[contentIndex]) ? data[contentIndex] : data;
        this.component.pDatatableComponent.totalRecords = (data[totalIndex]) ? data[totalIndex] : this.component.value.length;
    }
    /**
     * treatLoadResponseWithoutPaginationParameters method
     * @param {any} response
     * @param {any} data
     * @returns void
     */
    treatLoadResponseWithoutPaginationParameters(response, data) {
        if (response.headers.has('x-total-count')) {
            this.component.pDatatableComponent.totalRecords = parseInt(response.headers.get('x-total-count'), 10);
            this.component.value = data;
        }
        else {
            this.component.pDatatableComponent.totalRecords = data.totalElements;
            this.component.value = data.content;
        }
    }
    /**
     * retrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    retrieveAndSaveQuery(query) {
        const oldQuery = this._query;
        const currentQuery = this.doRetrieveAndSaveQuery(query);
        this.resetToFirstPageIfQueryChanged(oldQuery, currentQuery);
        return currentQuery;
    }
    /**
     * doRetrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    doRetrieveAndSaveQuery(query) {
        if ('object' === typeof query && query.value) {
            this._query = query.value;
        }
        else if (query) {
            this._query = query;
        }
        return this._query;
    }
    /**
     * resetToFirstPageIfQueryChanged method
     * @param {any} oldQuery
     * @param {any} currentQuery
     * @returns void
     */
    resetToFirstPageIfQueryChanged(oldQuery, currentQuery) {
        if (oldQuery !== currentQuery) {
            this.currentLazyLoadEvent.first = 0;
            this.component.pDatatableComponent.first = 0;
        }
    }
    /**
     * reset method
     * @returns void
     */
    reset() {
        this._query = undefined;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLWRhdGFwcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BudXZlbS9wcmltZW5nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvZGF0YXRhYmxlL3NlcnZlci1kYXRhcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBS0E7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLGtCQUFrQjtJQWMzQjs7Ozs7T0FLRztJQUNILFlBQW9CLGdCQUFrQyxFQUFVLFNBQTZCO1FBQXpFLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFvQjtRQUN6RixJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFvQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDMUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ25ELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsVUFBVSxDQUFDLEtBQW9CO1FBQzNCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBSSxDQUFDLEtBQVc7UUFDWixLQUFLLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQ3hCLElBQUksQ0FBQyxvQkFBb0IsRUFDekIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQ2xCLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUN2QyxJQUFJLENBQUMsU0FBUyxDQUFD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QUNkLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1NBQ3ZCO1FBQ0QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNLLDhCQUE4QixDQUFDLFFBQVEsRUFBRSxZQUFZO1FBQ3pELElBQUksUUFBUSxLQUFLLFlBQVksRUFBRTtZQUMzQixJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNwQyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7U0FDaEQ7SUFDTCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0gsS0FBSztRQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO0lBQzVCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExhenlMb2FkRXZlbnQgfSBmcm9tICdwcmltZW5nJztcbmltcG9ydCB7IERhdGF0YWJsZUNvbXBvbmVudCB9IGZyb20gJy4vZGF0YXRhYmxlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEYXRhdGFibGVTZXJ2aWNlIH0gZnJvbSAnLi9kYXRhdGFibGUuc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhUHJvdmlkZXIgfSBmcm9tICcuL2RhdGFwcm92aWRlcic7XG5cbi8qKlxuICogQ2xhc3MgU2VydmVyRGF0YVByb3ZpZGVyXG4gKiBAY2xhc3NcbiAqL1xuZXhwb3J0IGNsYXNzIFNlcnZlckRhdGFQcm92aWRlciBpbXBsZW1lbnRzIERhdGFQcm92aWRlciB7XG5cbiAgICAvKipcbiAgICAgKiBjdXJyZW50TGF6eUxvYWRFdmVudCBwcm9wZXJ0eVxuICAgICAqIEB0eXBlIHtMYXp5TG9hZEV2ZW50fVxuICAgICAqL1xuICAgIGN1cnJlbnRMYXp5TG9hZEV2ZW50OiBMYXp5TG9hZEV2ZW50O1xuXG4gICAgLyoqXG4gICAgICogX3F1ZXJ5IHByb3BlcnR5XG4gICAgICogQHR5cGUge2FueX1cbiAgICAgKi9cbiAgICBwcml2YXRlIF9xdWVyeTogYW55O1xuXG4gICAgLyoqXG4gICAgICogY29uc3RydWN0b3IgbWV0aG9kXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtEYXRhdGFibGVTZXJ2aWNlfSBkYXRhdGFibGVTZXJ2aWNlXG4gICAgICogQHBhcmFtIHtEYXRhdGFibGVDb21wb25lbnR9IGNvbXBvbmVudFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YXRhYmxlU2VydmljZTogRGF0YXRhYmxlU2VydmljZSwgcHJpdmF0ZSBjb21wb25lbnQ6IERhdGF0YWJsZUNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50Lm9uTGF6eUxvYWQuc3Vic2NyaWJlKChldmVudDogTGF6eUxvYWRFdmVudCkgPT4gdGhpcy5vbkxhenlMb2FkKGV2ZW50KSk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQubGF6eSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogb25MYXp5TG9hZCBtZXRob2RcbiAgICAgKiBAcGFyYW0ge0xhenlMb2FkRXZlbnR9IG9uTGF6eUxvYWRcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgb25MYXp5TG9hZChldmVudDogTGF6eUxvYWRFdmVudCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRMYXp5TG9hZEV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGxvYWQgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHF1ZXJ5XG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIGxvYWQocXVlcnk/OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgcXVlcnkgPSB0aGlzLnJldHJpZXZlQW5kU2F2ZVF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5jb21wb25lbnQuc3RhcnRlZExvYWRpbmcuZW1pdCgpO1xuICAgICAgICB0aGlzLmRhdGF0YWJsZVNlcnZpY2Uuc2VhcmNoKFxuICAgICAgICAgICAgdGhpcy5jdXJyZW50TGF6eUxvYWRFdmVudCxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnVybCxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQucm93cyxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lm9yZGVySW5Tb3J0LFxuICAgICAgICAgICAgcXVlcnkpXG4gICAgICAgICAgICAudG9Qcm9taXNlKClcbiAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmVhdExvYWRSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuZmluaXNoZWRMb2FkaW5nLmVtaXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5maW5pc2hlZExvYWRpbmcuZW1pdChlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdHJlYXRMb2FkUmVzcG9uc2UgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHJlc3BvbnNlXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgcHJpdmF0ZSB0cmVhdExvYWRSZXNwb25zZShyZXNwb25zZTogYW55KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5ib2R5O1xuICAgICAgICBpZiAodGhpcy5jb21wb25lbnQucGFnaW5hdGlvblBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMudHJlYXRMb2FkUmVzcG9uc2VXaXRoUGFnaW5hdGlvblBhcmFtZXRlcnMoZGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRyZWF0TG9hZFJlc3BvbnNlV2l0aG91dFBhZ2luYXRpb25QYXJhbWV0ZXJzKHJlc3BvbnNlLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHRyZWF0TG9hZFJlc3BvbnNlV2l0aFBhZ2luYXRpb25QYXJhbWV0ZXJzIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7YW55fSBkYXRhXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHByaXZhdGUgdHJlYXRMb2FkUmVzcG9uc2VXaXRoUGFnaW5hdGlvblBhcmFtZXRlcnMoZGF0YSkge1xuICAgICAgICBsZXQgY29udGVudEluZGV4ID0gdGhpcy5jb21wb25lbnQucGFnaW5hdGlvblBhcmFtZXRlcnMuY29udGVudEluZGV4O1xuICAgICAgICBsZXQgdG90YWxJbmRleCA9IHRoaXMuY29tcG9uZW50LnBhZ2luYXRpb25QYXJhbWV0ZXJzLnRvdGFsRWxlbWVudHNJbmRleDtcbiAgICAgICAgdGhpcy5jb21wb25lbnQudmFsdWUgPSAoZGF0YVtjb250ZW50SW5kZXhdKT8gZGF0YVtjb250ZW50SW5kZXhdOiBkYXRhO1xuICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50LnRvdGFsUmVjb3JkcyA9IChkYXRhW3RvdGFsSW5kZXhdKT8gZGF0YVt0b3RhbEluZGV4XTogdGhpcy5jb21wb25lbnQudmFsdWUubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHRyZWF0TG9hZFJlc3BvbnNlV2l0aG91dFBhZ2luYXRpb25QYXJhbWV0ZXJzIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7YW55fSByZXNwb25zZVxuICAgICAqIEBwYXJhbSB7YW55fSBkYXRhXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHByaXZhdGUgdHJlYXRMb2FkUmVzcG9uc2VXaXRob3V0UGFnaW5hdGlvblBhcmFtZXRlcnMocmVzcG9uc2U6IGFueSwgZGF0YSkge1xuICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVycy5oYXMoJ3gtdG90YWwtY291bnQnKSkge1xuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQucERhdGF0YWJsZUNvbXBvbmVudC50b3RhbFJlY29yZHMgPSBwYXJzZUludChyZXNwb25zZS5oZWFkZXJzLmdldCgneC10b3RhbC1jb3VudCcpLCAxMCk7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC52YWx1ZSA9IGRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50LnRvdGFsUmVjb3JkcyA9IGRhdGEudG90YWxFbGVtZW50cztcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnZhbHVlID0gZGF0YS5jb250ZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmV0cmlldmVBbmRTYXZlUXVlcnkgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHF1ZXJ5XG4gICAgICogQHJldHVybnMgYW55XG4gICAgICovXG4gICAgcHJpdmF0ZSByZXRyaWV2ZUFuZFNhdmVRdWVyeShxdWVyeTogYW55KTogYW55IHtcbiAgICAgICAgY29uc3Qgb2xkUXVlcnkgPSB0aGlzLl9xdWVyeTtcbiAgICAgICAgY29uc3QgY3VycmVudFF1ZXJ5ID0gdGhpcy5kb1JldHJpZXZlQW5kU2F2ZVF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5yZXNldFRvRmlyc3RQYWdlSWZRdWVyeUNoYW5nZWQob2xkUXVlcnksIGN1cnJlbnRRdWVyeSk7XG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlcnk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZG9SZXRyaWV2ZUFuZFNhdmVRdWVyeSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gcXVlcnlcbiAgICAgKiBAcmV0dXJucyBhbnlcbiAgICAgKi9cbiAgICBwcml2YXRlIGRvUmV0cmlldmVBbmRTYXZlUXVlcnkocXVlcnk6IGFueSk6IGFueSB7XG4gICAgICAgIGlmICgnb2JqZWN0JyA9PT0gdHlwZW9mIHF1ZXJ5ICYmIHF1ZXJ5LnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9xdWVyeSA9IHF1ZXJ5LnZhbHVlO1xuICAgICAgICB9IGVsc2UgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgICB0aGlzLl9xdWVyeSA9IHF1ZXJ5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZXNldFRvRmlyc3RQYWdlSWZRdWVyeUNoYW5nZWQgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IG9sZFF1ZXJ5XG4gICAgICogQHBhcmFtIHthbnl9IGN1cnJlbnRRdWVyeVxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc2V0VG9GaXJzdFBhZ2VJZlF1ZXJ5Q2hhbmdlZChvbGRRdWVyeSwgY3VycmVudFF1ZXJ5KSB7XG4gICAgICAgIGlmIChvbGRRdWVyeSAhPT0gY3VycmVudFF1ZXJ5KSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMYXp5TG9hZEV2ZW50LmZpcnN0ID0gMDtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQuZmlyc3QgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJlc2V0IG1ldGhvZFxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5fcXVlcnkgPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuIl19