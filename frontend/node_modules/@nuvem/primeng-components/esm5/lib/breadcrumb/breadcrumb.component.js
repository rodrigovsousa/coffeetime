import { __decorate, __read, __spread } from "tslib";
import { Component } from '@angular/core';
import { MenuItem, MessageService, Message } from 'primeng';
import { BreadcrumbService } from './breadcrumb.service';
import { AccessbilityService } from '@nuvem/angular-base';
import { ActivatedRoute, Router, NavigationEnd } from '@angular/router';
import { filter, distinctUntilChanged } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from 'primeng';
import * as ɵngcc3 from '@nuvem/angular-base';
import * as ɵngcc4 from '@angular/common';

function BreadcrumbComponent_ng_template_8_a_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 10);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var item_r1032 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("routerLink", item_r1032.routerLink);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(item_r1032.label);
} }
function BreadcrumbComponent_ng_template_8_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    var item_r1032 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(item_r1032.label);
} }
function BreadcrumbComponent_ng_template_8_li_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li");
    ɵngcc0.ɵɵtext(1, "/");
    ɵngcc0.ɵɵelementEnd();
} }
function BreadcrumbComponent_ng_template_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li");
    ɵngcc0.ɵɵtemplate(1, BreadcrumbComponent_ng_template_8_a_1_Template, 2, 2, "a", 8);
    ɵngcc0.ɵɵtemplate(2, BreadcrumbComponent_ng_template_8_ng_container_2_Template, 2, 1, "ng-container", 9);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(3, BreadcrumbComponent_ng_template_8_li_3_Template, 2, 0, "li", 9);
} if (rf & 2) {
    var item_r1032 = ctx.$implicit;
    var last_r1033 = ctx.last;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", item_r1032.routerLink);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !item_r1032.routerLink);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !last_r1033);
} }
var _c0 = function () { return { "cursor": "pointer" }; };
var _c1 = ["*"];
var BreadcrumbComponent = /** @class */ (function () {
    function BreadcrumbComponent(router, activatedRoute, breadcrumbService, messages, accessibilityService) {
        var _this = this;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.breadcrumbService = breadcrumbService;
        this.messages = messages;
        this.accessibilityService = accessibilityService;
        this.highContrastEnabled = false;
        this.subscription = breadcrumbService.itemsHandler.subscribe(function (response) {
            _this.items = response;
        });
    }
    BreadcrumbComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.router.events.pipe(filter(function (event) { return event instanceof NavigationEnd; }), distinctUntilChanged()).subscribe(function (event) {
            _this.items = _this.buildBreadCrumb(_this.activatedRoute.root);
        });
    };
    BreadcrumbComponent.prototype.ngOnDestroy = function () {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    };
    BreadcrumbComponent.prototype.enableHighContrast = function () {
        this.highContrastEnabled = true;
        this.accessibilityService.enableHighContrast();
    };
    BreadcrumbComponent.prototype.disableHighContrast = function () {
        this.highContrastEnabled = false;
        this.accessibilityService.disableHighContrast();
    };
    BreadcrumbComponent.prototype.increaseFontSize = function () {
        this.accessibilityService.increaseFontSize();
    };
    BreadcrumbComponent.prototype.decreaseFontSize = function () {
        this.accessibilityService.decreaseFontSize();
    };
    BreadcrumbComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.messages.messageObserver.subscribe(function (msg) {
            _this.accessibilityService.addAccessibilityMessages({ severity: msg.severity });
        });
        this.accessibilityService.addAccessibilityIcons();
    };
    BreadcrumbComponent.prototype.buildBreadCrumb = function (route, url, breadcrumbs) {
        if (url === void 0) { url = ''; }
        if (breadcrumbs === void 0) { breadcrumbs = []; }
        var label = route.routeConfig && route.routeConfig.data ? route.routeConfig.data.breadcrumb : '';
        var path = route.routeConfig && route.routeConfig.data ? route.routeConfig.path : '';
        var lastRoutePart = path.split('/').pop();
        var isDynamicRoute = lastRoutePart.startsWith(':');
        if (isDynamicRoute && !!route.snapshot) {
            for (var key in route.snapshot.params) {
                path = path.replace(":" + key, route.snapshot.params[key]);
            }
            label = Object.values(route.snapshot.params).join(' ');
        }
        var nextUrl = path ? url + "/" + path : url;
        var menuItem = {
            "label": label,
            "routerLink": nextUrl
        };
        var newBreadcrumbs = menuItem.label ? __spread(breadcrumbs, [menuItem]) : __spread(breadcrumbs);
        if (route.firstChild) {
            return this.buildBreadCrumb(route.firstChild, nextUrl, newBreadcrumbs);
        }
        return newBreadcrumbs;
    };
    BreadcrumbComponent.ctorParameters = function () { return [
        { type: Router },
        { type: ActivatedRoute },
        { type: BreadcrumbService },
        { type: MessageService },
        { type: AccessbilityService }
    ]; };
BreadcrumbComponent.ɵfac = function BreadcrumbComponent_Factory(t) { return new (t || BreadcrumbComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(BreadcrumbService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.MessageService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.AccessbilityService)); };
BreadcrumbComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: BreadcrumbComponent, selectors: [["breadcrumb"]], ngContentSelectors: _c1, decls: 20, vars: 9, consts: [[1, "layout-breadcrumb"], ["routerLink", ""], [1, "material-icons"], ["ngFor", "", 3, "ngForOf"], [1, "layout-breadcrumb-options"], [3, "ngStyle", "title", "click"], ["title", "Aumentar fonte", 3, "ngStyle", "click"], ["title", "Diminuir fonte", 3, "ngStyle", "click"], [3, "routerLink", 4, "ngIf"], [4, "ngIf"], [3, "routerLink"]], template: function BreadcrumbComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "ul");
        ɵngcc0.ɵɵelementStart(2, "li");
        ɵngcc0.ɵɵelementStart(3, "a", 1);
        ɵngcc0.ɵɵelementStart(4, "i", 2);
        ɵngcc0.ɵɵtext(5, "home");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "li");
        ɵngcc0.ɵɵtext(7, "/");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, BreadcrumbComponent_ng_template_8_Template, 4, 3, "ng-template", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "div", 4);
        ɵngcc0.ɵɵelementStart(10, "a", 5);
        ɵngcc0.ɵɵlistener("click", function BreadcrumbComponent_Template_a_click_10_listener() { return ctx.highContrastEnabled ? ctx.disableHighContrast() : ctx.enableHighContrast(); });
        ɵngcc0.ɵɵelementStart(11, "i", 2);
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(13, "a", 6);
        ɵngcc0.ɵɵlistener("click", function BreadcrumbComponent_Template_a_click_13_listener() { return ctx.increaseFontSize(); });
        ɵngcc0.ɵɵelementStart(14, "i", 2);
        ɵngcc0.ɵɵtext(15, "exposure_plus_1");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(16, "a", 7);
        ɵngcc0.ɵɵlistener("click", function BreadcrumbComponent_Template_a_click_16_listener() { return ctx.decreaseFontSize(); });
        ɵngcc0.ɵɵelementStart(17, "i", 2);
        ɵngcc0.ɵɵtext(18, "exposure_neg_1");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵprojection(19);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(8);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.items);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate("title", ctx.highContrastEnabled ? "Desabilitar alto contraste" : "Habilitar alto contraste");
        ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction0(6, _c0));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ctx.highContrastEnabled ? "visibility_off" : "visibility");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction0(7, _c0));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction0(8, _c0));
    } }, directives: [ɵngcc1.RouterLinkWithHref, ɵngcc4.NgForOf, ɵngcc4.NgStyle, ɵngcc4.NgIf], styles: [""] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(BreadcrumbComponent, [{
        type: Component,
        args: [{
                selector: 'breadcrumb',
                template: "<div class=\"layout-breadcrumb\">\n    <ul>\n        <li>\n            <a routerLink=\"\">\n                <i class=\"material-icons\">home</i>\n            </a>\n        </li>\n        <li>/</li>\n        <ng-template ngFor let-item let-last=\"last\" [ngForOf]=\"items\">\n            <li>\n                <a [routerLink]=\"item.routerLink\" *ngIf=\"item.routerLink\">{{item.label}}</a>\n\n                <ng-container *ngIf=\"!item.routerLink\">{{item.label}}</ng-container>\n            </li>\n            <li *ngIf=\"!last\">/</li>\n        </ng-template>\n    </ul>\n    <div class=\"layout-breadcrumb-options\">\n        <a (click)=\"highContrastEnabled ? disableHighContrast() : enableHighContrast()\" [ngStyle]=\"{'cursor': 'pointer'}\"\n            title=\"{{ highContrastEnabled ? 'Desabilitar alto contraste' : 'Habilitar alto contraste' }}\">\n            <i class=\"material-icons\">{{ highContrastEnabled ? 'visibility_off' : 'visibility' }}</i>\n        </a>\n        <a (click)=\"increaseFontSize()\" title=\"Aumentar fonte\" [ngStyle]=\"{'cursor': 'pointer'}\">\n            <i class=\"material-icons\">exposure_plus_1</i>\n        </a>\n        <a (click)=\"decreaseFontSize()\" title=\"Diminuir fonte\" [ngStyle]=\"{'cursor': 'pointer'}\">\n            <i class=\"material-icons\">exposure_neg_1</i>\n        </a>\n    </div>\n    <ng-content></ng-content>\n</div>\n",
                styles: [""]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }, { type: BreadcrumbService }, { type: ɵngcc2.MessageService }, { type: ɵngcc3.AccessbilityService }]; }, null); })();
    return BreadcrumbComponent;
}());
export { BreadcrumbComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIm5nOi9AbnV2ZW0vcHJpbWVuZy1jb21wb25lbnRzL2xpYi9icmVhZGNydW1iL2JyZWFkY3J1bWIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUF5QixNQUFNLGVBQWUsQ0FBQztBQUVqRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDeEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTzlEO0FBQXVELElBUW5ELDZCQUNxQixNQUFjLEVBQ2QsY0FBOEIsRUFDOUIsaUJBQW9DLEVBQ3BDLFFBQXdCLEVBQ3hCLG9CQUF5QztBQUMvRCxRQU5DLGlCQVVDO0FBQ0wsUUFWeUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUFDLFFBQ2YsbUJBQWMsR0FBZCxjQUFjLENBQWdCO0FBQUMsUUFDL0Isc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtBQUFDLFFBQ3JDLGFBQVEsR0FBUixRQUFRLENBQWdCO0FBQUMsUUFDekIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFxQjtBQUNsRSxRQVJJLHdCQUFtQixHQUFHLEtBQUssQ0FBQztBQUNoQyxRQVFRLElBQUksQ0FBQyxZQUFZLEdBQUcsaUJBQWlCLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFBLFFBQVE7QUFBSSxZQUNyRSxLQUFJLENB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QUFRLEVBQUUsWUFBWSxjQUN0Qjs7Ozs7Ozs7Ozs7Ozs7OzttQkFBMEM7d0JBRTdDLENBQUMsUUFDVztRQUFtQixDQTZGL0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzRNQUNEO0FBQUMsSUFERCwwQkFBQztBQUNBLENBREEsQUE3RkQsSUE2RkM7QUFDRCxTQTlGYSxtQkFBbUI7QUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE1lbnVJdGVtLCBNZXNzYWdlU2VydmljZSwgTWVzc2FnZSB9IGZyb20gJ3ByaW1lbmcnO1xuaW1wb3J0IHsgQnJlYWRjcnVtYlNlcnZpY2UgfSBmcm9tICcuL2JyZWFkY3J1bWIuc2VydmljZSc7XG5pbXBvcnQgeyBBY2Nlc3NiaWxpdHlTZXJ2aWNlIH0gZnJvbSAnQG51dmVtL2FuZ3VsYXItYmFzZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyLCBOYXZpZ2F0aW9uRW5kIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IGZpbHRlciwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYnJlYWRjcnVtYicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2JyZWFkY3J1bWIuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2JyZWFkY3J1bWIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBCcmVhZGNydW1iQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcblxuICAgIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gICAgaXRlbXM6IE1lbnVJdGVtW107XG5cbiAgICBoaWdoQ29udHJhc3RFbmFibGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYnJlYWRjcnVtYlNlcnZpY2U6IEJyZWFkY3J1bWJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IG1lc3NhZ2VzOiBNZXNzYWdlU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBhY2Nlc3NpYmlsaXR5U2VydmljZTogQWNjZXNzYmlsaXR5U2VydmljZVxuICAgICkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IGJyZWFkY3J1bWJTZXJ2aWNlLml0ZW1zSGFuZGxlci5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IHJlc3BvbnNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIuZXZlbnRzLnBpcGUoZmlsdGVyKFxuICAgICAgICAgICAgKGV2ZW50OiBhbnkpID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCksXG4gICAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICApLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmJ1aWxkQnJlYWRDcnVtYih0aGlzLmFjdGl2YXRlZFJvdXRlLnJvb3QpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBlbmFibGVIaWdoQ29udHJhc3QoKSB7XG4gICAgICAgIHRoaXMuaGlnaENvbnRyYXN0RW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuZW5hYmxlSGlnaENvbnRyYXN0KCk7XG4gICAgfVxuXG4gICAgZGlzYWJsZUhpZ2hDb250cmFzdCgpIHtcbiAgICAgICAgdGhpcy5oaWdoQ29udHJhc3RFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuZGlzYWJsZUhpZ2hDb250cmFzdCgpO1xuICAgIH1cblxuICAgIGluY3JlYXNlRm9udFNpemUoKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuaW5jcmVhc2VGb250U2l6ZSgpO1xuICAgIH1cblxuICAgIGRlY3JlYXNlRm9udFNpemUoKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuZGVjcmVhc2VGb250U2l6ZSgpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5tZXNzYWdlT2JzZXJ2ZXIuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKG1zZzogTWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuYWRkQWNjZXNzaWJpbGl0eU1lc3NhZ2VzKHsgc2V2ZXJpdHk6IG1zZy5zZXZlcml0eSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5hY2Nlc3NpYmlsaXR5U2VydmljZS5hZGRBY2Nlc3NpYmlsaXR5SWNvbnMoKTtcbiAgICB9XG5cbiAgICBidWlsZEJyZWFkQ3J1bWIocm91dGU6IEFjdGl2YXRlZFJvdXRlLCB1cmw6IHN0cmluZyA9ICcnLCBicmVhZGNydW1iczogTWVudUl0ZW1bXSA9IFtdKTogTWVudUl0ZW1bXSB7XG5cbiAgICAgICAgbGV0IGxhYmVsID0gcm91dGUucm91dGVDb25maWcgJiYgcm91dGUucm91dGVDb25maWcuZGF0YSA/IHJvdXRlLnJvdXRlQ29uZmlnLmRhdGEuYnJlYWRjcnVtYiA6ICcnO1xuICAgICAgICBsZXQgcGF0aCA9IHJvdXRlLnJvdXRlQ29uZmlnICYmIHJvdXRlLnJvdXRlQ29uZmlnLmRhdGEgPyByb3V0ZS5yb3V0ZUNvbmZpZy5wYXRoIDogJyc7XG5cbiAgICAgICAgY29uc3QgbGFzdFJvdXRlUGFydCA9IHBhdGguc3BsaXQoJy8nKS5wb3AoKTtcbiAgICAgICAgY29uc3QgaXNEeW5hbWljUm91dGUgPSBsYXN0Um91dGVQYXJ0LnN0YXJ0c1dpdGgoJzonKTtcblxuICAgICAgICBpZiAoaXNEeW5hbWljUm91dGUgJiYgISFyb3V0ZS5zbmFwc2hvdCkge1xuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIHJvdXRlLnNuYXBzaG90LnBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoYDoke2tleX1gLCByb3V0ZS5zbmFwc2hvdC5wYXJhbXNba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYWJlbCA9IE9iamVjdC52YWx1ZXMocm91dGUuc25hcHNob3QucGFyYW1zKS5qb2luKCcgJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXh0VXJsID0gcGF0aCA/IGAke3VybH0vJHtwYXRofWAgOiB1cmw7XG5cbiAgICAgICAgY29uc3QgbWVudUl0ZW06IE1lbnVJdGVtID0ge1xuICAgICAgICAgICAgXCJsYWJlbFwiOiBsYWJlbCxcbiAgICAgICAgICAgIFwicm91dGVyTGlua1wiOiBuZXh0VXJsXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdCcmVhZGNydW1icyA9IG1lbnVJdGVtLmxhYmVsID8gWy4uLmJyZWFkY3J1bWJzLCBtZW51SXRlbV0gOiBbLi4uYnJlYWRjcnVtYnNdO1xuXG4gICAgICAgIGlmIChyb3V0ZS5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZEJyZWFkQ3J1bWIocm91dGUuZmlyc3RDaGlsZCwgbmV4dFVybCwgbmV3QnJlYWRjcnVtYnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld0JyZWFkY3J1bWJzO1xuICAgIH1cblxufVxuIl19