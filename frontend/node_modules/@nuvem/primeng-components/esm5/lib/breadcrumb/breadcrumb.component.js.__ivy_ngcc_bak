import { __decorate, __read, __spread } from "tslib";
import { Component } from '@angular/core';
import { MenuItem, MessageService, Message } from 'primeng';
import { BreadcrumbService } from './breadcrumb.service';
import { AccessbilityService } from '@nuvem/angular-base';
import { ActivatedRoute, Router, NavigationEnd } from '@angular/router';
import { filter, distinctUntilChanged } from 'rxjs/operators';
var BreadcrumbComponent = /** @class */ (function () {
    function BreadcrumbComponent(router, activatedRoute, breadcrumbService, messages, accessibilityService) {
        var _this = this;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.breadcrumbService = breadcrumbService;
        this.messages = messages;
        this.accessibilityService = accessibilityService;
        this.highContrastEnabled = false;
        this.subscription = breadcrumbService.itemsHandler.subscribe(function (response) {
            _this.items = response;
        });
    }
    BreadcrumbComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.router.events.pipe(filter(function (event) { return event instanceof NavigationEnd; }), distinctUntilChanged()).subscribe(function (event) {
            _this.items = _this.buildBreadCrumb(_this.activatedRoute.root);
        });
    };
    BreadcrumbComponent.prototype.ngOnDestroy = function () {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    };
    BreadcrumbComponent.prototype.enableHighContrast = function () {
        this.highContrastEnabled = true;
        this.accessibilityService.enableHighContrast();
    };
    BreadcrumbComponent.prototype.disableHighContrast = function () {
        this.highContrastEnabled = false;
        this.accessibilityService.disableHighContrast();
    };
    BreadcrumbComponent.prototype.increaseFontSize = function () {
        this.accessibilityService.increaseFontSize();
    };
    BreadcrumbComponent.prototype.decreaseFontSize = function () {
        this.accessibilityService.decreaseFontSize();
    };
    BreadcrumbComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.messages.messageObserver.subscribe(function (msg) {
            _this.accessibilityService.addAccessibilityMessages({ severity: msg.severity });
        });
        this.accessibilityService.addAccessibilityIcons();
    };
    BreadcrumbComponent.prototype.buildBreadCrumb = function (route, url, breadcrumbs) {
        if (url === void 0) { url = ''; }
        if (breadcrumbs === void 0) { breadcrumbs = []; }
        var label = route.routeConfig && route.routeConfig.data ? route.routeConfig.data.breadcrumb : '';
        var path = route.routeConfig && route.routeConfig.data ? route.routeConfig.path : '';
        var lastRoutePart = path.split('/').pop();
        var isDynamicRoute = lastRoutePart.startsWith(':');
        if (isDynamicRoute && !!route.snapshot) {
            for (var key in route.snapshot.params) {
                path = path.replace(":" + key, route.snapshot.params[key]);
            }
            label = Object.values(route.snapshot.params).join(' ');
        }
        var nextUrl = path ? url + "/" + path : url;
        var menuItem = {
            "label": label,
            "routerLink": nextUrl
        };
        var newBreadcrumbs = menuItem.label ? __spread(breadcrumbs, [menuItem]) : __spread(breadcrumbs);
        if (route.firstChild) {
            return this.buildBreadCrumb(route.firstChild, nextUrl, newBreadcrumbs);
        }
        return newBreadcrumbs;
    };
    BreadcrumbComponent.ctorParameters = function () { return [
        { type: Router },
        { type: ActivatedRoute },
        { type: BreadcrumbService },
        { type: MessageService },
        { type: AccessbilityService }
    ]; };
    BreadcrumbComponent = __decorate([
        Component({
            selector: 'breadcrumb',
            template: "<div class=\"layout-breadcrumb\">\n    <ul>\n        <li>\n            <a routerLink=\"\">\n                <i class=\"material-icons\">home</i>\n            </a>\n        </li>\n        <li>/</li>\n        <ng-template ngFor let-item let-last=\"last\" [ngForOf]=\"items\">\n            <li>\n                <a [routerLink]=\"item.routerLink\" *ngIf=\"item.routerLink\">{{item.label}}</a>\n\n                <ng-container *ngIf=\"!item.routerLink\">{{item.label}}</ng-container>\n            </li>\n            <li *ngIf=\"!last\">/</li>\n        </ng-template>\n    </ul>\n    <div class=\"layout-breadcrumb-options\">\n        <a (click)=\"highContrastEnabled ? disableHighContrast() : enableHighContrast()\" [ngStyle]=\"{'cursor': 'pointer'}\"\n            title=\"{{ highContrastEnabled ? 'Desabilitar alto contraste' : 'Habilitar alto contraste' }}\">\n            <i class=\"material-icons\">{{ highContrastEnabled ? 'visibility_off' : 'visibility' }}</i>\n        </a>\n        <a (click)=\"increaseFontSize()\" title=\"Aumentar fonte\" [ngStyle]=\"{'cursor': 'pointer'}\">\n            <i class=\"material-icons\">exposure_plus_1</i>\n        </a>\n        <a (click)=\"decreaseFontSize()\" title=\"Diminuir fonte\" [ngStyle]=\"{'cursor': 'pointer'}\">\n            <i class=\"material-icons\">exposure_neg_1</i>\n        </a>\n    </div>\n    <ng-content></ng-content>\n</div>\n",
            styles: [""]
        })
    ], BreadcrumbComponent);
    return BreadcrumbComponent;
}());
export { BreadcrumbComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AbnV2ZW0vcHJpbWVuZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2JyZWFkY3J1bWIvYnJlYWRjcnVtYi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXlCLE1BQU0sZUFBZSxDQUFDO0FBRWpFLE9BQU8sRUFBRSxRQUFRLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsTUFBTSxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFPOUQ7SUFRSSw2QkFDcUIsTUFBYyxFQUNkLGNBQThCLEVBQzlCLGlCQUFvQyxFQUNwQyxRQUF3QixFQUN4QixvQkFBeUM7UUFMOUQsaUJBVUM7UUFUb0IsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGFBQVEsR0FBUixRQUFRLENBQWdCO1FBQ3hCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBcUI7UUFQOUQsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBU3hCLElBQUksQ0FBQyxZQUFZLEdBQUcsaUJBQWlCLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFBLFFBQVE7WUFDakUsS0FBSSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsc0NBQVEsR0FBUjtRQUFBLGlCQU9DO1FB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LE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFJLEdBQUcsU0FBSSxJQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUU5QyxJQUFNLFFBQVEsR0FBYTtZQUN2QixPQUFPLEVBQUUsS0FBSztZQUNkLFlBQVksRUFBRSxPQUFPO1NBQ3hCLENBQUE7UUFFRCxJQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsVUFBSyxXQUFXLEdBQUUsUUFBUSxHQUFFLENBQUMsVUFBSyxXQUFXLENBQUMsQ0FBQztRQUV0RixJQUFJLEtBQUssQ0FBQyxVQUFVLEVBQUU7WUFDbEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDO1NBQzFFO1FBRUQsT0FBTyxjQUFjLENBQUM7SUFDMUIsQ0FBQzs7Z0JBbEY0QixNQUFNO2dCQUNFLGNBQWM7Z0JBQ1gsaUJBQWlCO2dCQUMxQixjQUFjO2dCQUNGLG1CQUFtQjs7SUFickQsbUJBQW1CO1FBTC9CLFNBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxZQUFZO1lBQ3RCLHczQ0FBMEM7O1NBRTdDLENBQUM7T0FDVyxtQkFBbUIsQ0E2Ri9CO0lBQUQsMEJBQUM7Q0FBQSxBQTdGRCxJQTZGQztTQTdGWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNZW51SXRlbSwgTWVzc2FnZVNlcnZpY2UsIE1lc3NhZ2UgfSBmcm9tICdwcmltZW5nJztcbmltcG9ydCB7IEJyZWFkY3J1bWJTZXJ2aWNlIH0gZnJvbSAnLi9icmVhZGNydW1iLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWNjZXNzYmlsaXR5U2VydmljZSB9IGZyb20gJ0BudXZlbS9hbmd1bGFyLWJhc2UnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciwgTmF2aWdhdGlvbkVuZCB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBmaWx0ZXIsIGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2JyZWFkY3J1bWInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9icmVhZGNydW1iLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9icmVhZGNydW1iLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQnJlYWRjcnVtYkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgICBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICAgIGl0ZW1zOiBNZW51SXRlbVtdO1xuXG4gICAgaGlnaENvbnRyYXN0RW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGJyZWFkY3J1bWJTZXJ2aWNlOiBCcmVhZGNydW1iU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBtZXNzYWdlczogTWVzc2FnZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYWNjZXNzaWJpbGl0eVNlcnZpY2U6IEFjY2Vzc2JpbGl0eVNlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSBicmVhZGNydW1iU2VydmljZS5pdGVtc0hhbmRsZXIuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSByZXNwb25zZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMucm91dGVyLmV2ZW50cy5waXBlKGZpbHRlcihcbiAgICAgICAgICAgIChldmVudDogYW55KSA9PiBldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpLFxuICAgICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgKS5zdWJzY3JpYmUoKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5idWlsZEJyZWFkQ3J1bWIodGhpcy5hY3RpdmF0ZWRSb3V0ZS5yb290KTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZW5hYmxlSGlnaENvbnRyYXN0KCkge1xuICAgICAgICB0aGlzLmhpZ2hDb250cmFzdEVuYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmFjY2Vzc2liaWxpdHlTZXJ2aWNlLmVuYWJsZUhpZ2hDb250cmFzdCgpO1xuICAgIH1cblxuICAgIGRpc2FibGVIaWdoQ29udHJhc3QoKSB7XG4gICAgICAgIHRoaXMuaGlnaENvbnRyYXN0RW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFjY2Vzc2liaWxpdHlTZXJ2aWNlLmRpc2FibGVIaWdoQ29udHJhc3QoKTtcbiAgICB9XG5cbiAgICBpbmNyZWFzZUZvbnRTaXplKCkge1xuICAgICAgICB0aGlzLmFjY2Vzc2liaWxpdHlTZXJ2aWNlLmluY3JlYXNlRm9udFNpemUoKTtcbiAgICB9XG5cbiAgICBkZWNyZWFzZUZvbnRTaXplKCkge1xuICAgICAgICB0aGlzLmFjY2Vzc2liaWxpdHlTZXJ2aWNlLmRlY3JlYXNlRm9udFNpemUoKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMubWVzc2FnZU9ic2VydmVyLnN1YnNjcmliZShcbiAgICAgICAgICAgIChtc2c6IE1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc2liaWxpdHlTZXJ2aWNlLmFkZEFjY2Vzc2liaWxpdHlNZXNzYWdlcyh7IHNldmVyaXR5OiBtc2cuc2V2ZXJpdHkgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuYWNjZXNzaWJpbGl0eVNlcnZpY2UuYWRkQWNjZXNzaWJpbGl0eUljb25zKCk7XG4gICAgfVxuXG4gICAgYnVpbGRCcmVhZENydW1iKHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSwgdXJsOiBzdHJpbmcgPSAnJywgYnJlYWRjcnVtYnM6IE1lbnVJdGVtW10gPSBbXSk6IE1lbnVJdGVtW10ge1xuXG4gICAgICAgIGxldCBsYWJlbCA9IHJvdXRlLnJvdXRlQ29uZmlnICYmIHJvdXRlLnJvdXRlQ29uZmlnLmRhdGEgPyByb3V0ZS5yb3V0ZUNvbmZpZy5kYXRhLmJyZWFkY3J1bWIgOiAnJztcbiAgICAgICAgbGV0IHBhdGggPSByb3V0ZS5yb3V0ZUNvbmZpZyAmJiByb3V0ZS5yb3V0ZUNvbmZpZy5kYXRhID8gcm91dGUucm91dGVDb25maWcucGF0aCA6ICcnO1xuXG4gICAgICAgIGNvbnN0IGxhc3RSb3V0ZVBhcnQgPSBwYXRoLnNwbGl0KCcvJykucG9wKCk7XG4gICAgICAgIGNvbnN0IGlzRHluYW1pY1JvdXRlID0gbGFzdFJvdXRlUGFydC5zdGFydHNXaXRoKCc6Jyk7XG5cbiAgICAgICAgaWYgKGlzRHluYW1pY1JvdXRlICYmICEhcm91dGUuc25hcHNob3QpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiByb3V0ZS5zbmFwc2hvdC5wYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKGA6JHtrZXl9YCwgcm91dGUuc25hcHNob3QucGFyYW1zW2tleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFiZWwgPSBPYmplY3QudmFsdWVzKHJvdXRlLnNuYXBzaG90LnBhcmFtcykuam9pbignICcpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV4dFVybCA9IHBhdGggPyBgJHt1cmx9LyR7cGF0aH1gIDogdXJsO1xuXG4gICAgICAgIGNvbnN0IG1lbnVJdGVtOiBNZW51SXRlbSA9IHtcbiAgICAgICAgICAgIFwibGFiZWxcIjogbGFiZWwsXG4gICAgICAgICAgICBcInJvdXRlckxpbmtcIjogbmV4dFVybFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV3QnJlYWRjcnVtYnMgPSBtZW51SXRlbS5sYWJlbCA/IFsuLi5icmVhZGNydW1icywgbWVudUl0ZW1dIDogWy4uLmJyZWFkY3J1bWJzXTtcblxuICAgICAgICBpZiAocm91dGUuZmlyc3RDaGlsZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRCcmVhZENydW1iKHJvdXRlLmZpcnN0Q2hpbGQsIG5leHRVcmwsIG5ld0JyZWFkY3J1bWJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXdCcmVhZGNydW1icztcbiAgICB9XG5cbn1cbiJdfQ==