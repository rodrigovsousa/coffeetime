import { __decorate, __param } from "tslib";
import { Component, Inject, Input, Output, EventEmitter, ViewChild, ContentChildren } from "@angular/core";
import { CRUD_SERVICE } from "./crud-service.service";
import { Router, ActivatedRoute } from "@angular/router";
import { Column } from '../datatable/p-column.directive';
import { ConfirmationService } from 'primeng/api';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'primeng/api';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from './form.component';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '../datatable/datatable.component';
import * as ɵngcc6 from 'primeng/confirmdialog';
import * as ɵngcc7 from 'primeng';

var _c0 = ["datatable"];
var _c1 = function () { return ["../save"]; };
function CrudListComponent_button_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "button", 6);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(1, _c1));
} }
var _c2 = [[["", "nForm", ""]], [["p-column"]]];
var _c3 = ["[nForm]", "p-column"];
var CrudListComponent = /** @class */ (function () {
    function CrudListComponent(crudService, confirmationService, route, router) {
        this.crudService = crudService;
        this.confirmationService = confirmationService;
        this.route = route;
        this.router = router;
        this.action = "findAll";
        this.findLabel = "Pesquisar";
        this.disableSave = false;
        this.disableEdit = false;
        this.disableView = false;
        this.disableDelete = false;
        this.find = new EventEmitter();
    }
    CrudListComponent.prototype.ngOnInit = function () {
        if (this.service) {
            this.crudService = this.service;
        }
        if (!this.url) {
            this.url = this.crudService.uri;
        }
    };
    CrudListComponent.prototype.datatableClick = function (event) {
        var _this = this;
        if (event.selection) {
            switch (event.button) {
                case "edit":
                case "view":
                    this.router.navigate(["../" + event.button, event.selection.id], { relativeTo: this.route });
                    break;
                case "delete":
                    this.confirmationService.confirm({
                        message: 'Você tem certeza que deseja excluir o registro?',
                        accept: function () { return _this.crudService.delete(event.selection.id)
                            .subscribe(function () { return _this.datatable.filter(); }); }
                    });
                    break;
            }
        }
    };
    CrudListComponent.prototype.findAll = function (event) {
        var _this = this;
        if (this.find.observers.length) {
            this.find.emit(this.form.value);
        }
        else {
            this.datatable.filterParams = {};
            Object.keys(this.form.value).forEach(function (element) {
                var value = _this.form.value[element];
                if (value) {
                    _this.datatable.filterParams[element] =
                        value instanceof Date ? JSON.stringify(value).replace(/"/g, "") : value;
                }
            });
            this.datatable.filter();
        }
    };
    CrudListComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        var datatableNgAfterContentInit = this.datatable.pDatatableComponent.ngAfterContentInit;
        this.datatable.pDatatableComponent.ngAfterContentInit = function () {
            _this.datatable.pDatatableComponent.columns = _this.columns.toArray();
            datatableNgAfterContentInit.call(_this.datatable.pDatatableComponent);
        };
    };
    CrudListComponent.prototype.ngAfterViewInit = function () {
        for (var i in this.datatableExtraParams) {
            this.datatable[i] = this.datatableExtraParams[i];
        }
    };
    CrudListComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [CRUD_SERVICE,] }] },
        { type: ConfirmationService },
        { type: ActivatedRoute },
        { type: Router }
    ]; };
    __decorate([
        Input()
    ], CrudListComponent.prototype, "form", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "action", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "findLabel", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "service", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "url", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "disableSave", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "disableEdit", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "disableView", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "disableDelete", void 0);
    __decorate([
        Input()
    ], CrudListComponent.prototype, "datatableExtraParams", void 0);
    __decorate([
        Output()
    ], CrudListComponent.prototype, "find", void 0);
    __decorate([
        ViewChild('datatable', { static: true })
    ], CrudListComponent.prototype, "datatable", void 0);
    __decorate([
        ContentChildren(Column)
    ], CrudListComponent.prototype, "columns", void 0);
    CrudListComponent = __decorate([ __param(0, Inject(CRUD_SERVICE))
    ], CrudListComponent);
CrudListComponent.ɵfac = function CrudListComponent_Factory(t) { return new (t || CrudListComponent)(ɵngcc0.ɵɵdirectiveInject(CRUD_SERVICE), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ConfirmationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
CrudListComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: CrudListComponent, selectors: [["nCrudList"]], contentQueries: function CrudListComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, Column, false);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.columns = _t);
    } }, viewQuery: function CrudListComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.datatable = _t.first);
    } }, inputs: { action: "action", findLabel: "findLabel", disableSave: "disableSave", disableEdit: "disableEdit", disableView: "disableView", disableDelete: "disableDelete", url: "url", form: "form", service: "service", datatableExtraParams: "datatableExtraParams" }, outputs: { find: "find" }, ngContentSelectors: _c3, decls: 8, vars: 8, consts: [[3, "form", "saveLabel", "save"], ["nButton", "", 1, "ui-g-12", "ui-lg-2", "ui-md-4", "ui-sm-12"], ["pButton", "", "type", "button", "label", "Novo", 3, "routerLink", 4, "ngIf"], [3, "value", "url", "disableEdit", "disableView", "disableDelete", "buttonClick"], ["datatable", ""], ["header", "Confirmar Exclus\u00E3o", "acceptLabel", "Sim", "rejectLabel", "N\u00E3o", "icon", "pi pi-exclamation-triangle"], ["pButton", "", "type", "button", "label", "Novo", 3, "routerLink"]], template: function CrudListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c2);
        ɵngcc0.ɵɵelementStart(0, "nForm", 0);
        ɵngcc0.ɵɵlistener("save", function CrudListComponent_Template_nForm_save_0_listener($event) { return ctx.findAll($event); });
        ɵngcc0.ɵɵprojection(1);
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵtemplate(3, CrudListComponent_button_3_Template, 1, 2, "button", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "basis-datatable", 3, 4);
        ɵngcc0.ɵɵlistener("buttonClick", function CrudListComponent_Template_basis_datatable_buttonClick_4_listener($event) { return ctx.datatableClick($event); });
        ɵngcc0.ɵɵprojection(6, 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(7, "p-confirmDialog", 5);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("form", ctx.form)("saveLabel", ctx.findLabel);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.disableSave);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("value", ctx.result)("url", ctx.url)("disableEdit", ctx.disableEdit)("disableView", ctx.disableView)("disableDelete", ctx.disableDelete);
    } }, directives: [ɵngcc3.FormComponent, ɵngcc4.NgIf, ɵngcc5.DatatableComponent, ɵngcc6.ConfirmDialog, ɵngcc7.ButtonDirective, ɵngcc2.RouterLink], encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(CrudListComponent, [{
        type: Component,
        args: [{
                selector: 'nCrudList',
                template: "<nForm [form]=\"form\" (save)=\"findAll($event)\" [saveLabel]=\"findLabel\">\n    <ng-content select=\"[nForm]\"></ng-content>\n    <div nButton class=\"ui-g-12 ui-lg-2 ui-md-4 ui-sm-12\">\n        <button pButton type=\"button\" [routerLink]=\"['../save']\" label=\"Novo\" *ngIf=\"!disableSave\"></button>\n    </div>\n</nForm>\n\n<basis-datatable #datatable [value]=\"result\" (buttonClick)=\"datatableClick($event)\" [url]=\"url\"\n    [disableEdit]=\"disableEdit\" [disableView]=\"disableView\" [disableDelete]=\"disableDelete\">\n    <ng-content select=\"p-column\"></ng-content>\n</basis-datatable>\n\n<p-confirmDialog header=\"Confirmar Exclus\u00E3o\" acceptLabel=\"Sim\" rejectLabel=\"N\u00E3o\" icon=\"pi pi-exclamation-triangle\"></p-confirmDialog>\n"
            }]
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [CRUD_SERVICE]
            }] }, { type: ɵngcc1.ConfirmationService }, { type: ɵngcc2.ActivatedRoute }, { type: ɵngcc2.Router }]; }, { action: [{
            type: Input
        }], findLabel: [{
            type: Input
        }], disableSave: [{
            type: Input
        }], disableEdit: [{
            type: Input
        }], disableView: [{
            type: Input
        }], disableDelete: [{
            type: Input
        }], find: [{
            type: Output
        }], url: [{
            type: Input
        }], form: [{
            type: Input
        }], service: [{
            type: Input
        }], datatableExtraParams: [{
            type: Input
        }], datatable: [{
            type: ViewChild,
            args: ['datatable', { static: true }]
        }], columns: [{
            type: ContentChildren,
            args: [Column]
        }] }); })();
    return CrudListComponent;
}());
export { CrudListComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1ZC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmc6L0BudXZlbS9wcmltZW5nLWNvbXBvbmVudHMvbGliL2NydWQvY3J1ZC1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBVSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQ3RELFNBQVMsRUFBRSxlQUFlLEVBQzdCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBZSxZQUFZLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNuRSxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUl6RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPbEQ7QUFBcUQsSUE4QmpELDJCQUVXLFdBQWtDLEVBQ2pDLG1CQUF3QyxFQUN4QyxLQUFxQixFQUNyQixNQUFjO0FBQzNCLFFBSlksZ0JBQVcsR0FBWCxXQUFXLENBQXVCO0FBQUMsUUFDbEMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtBQUFDLFFBQ3pDLFVBQUssR0FBTCxLQUFLLENBQWdCO0FBQUMsUUFDdEIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUM5QixRQWhDYSxXQUFNLEdBQVcsU0FBUyxDQUFDO0FBQ3hDLFFBQ2EsY0FBUyxHQUFXLFdBQVcsQ0FBQztBQUM3QyxRQUthLGdCQUFXLEdBQUcsS0FBSyxDQUFDO0FBQ2pDLFFBQ2EsZ0JBQVcsR0FBRyxLQUFLLENBQUM7QUFDakMsUUFDYSxnQkFBVyxHQUFHLEtBQUssQ0FBQztBQUNqQyxRQUNhLGtCQUFhLEdBQUcsS0FBSyxDQUFDO0FBQ25DLFFBR2MsU0FBSSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0FBQ2hFLElBYVMsQ0FBQztBQUNW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LDREQUFzQjtBQUVuQyxJQUFhO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsbUVBQTBCO0FBRXZDLElBQWM7QUFBYSxRQUF0QixNQUFNLEVBQUU7QUFBQyxtREFBa0Q7QUFFaEUsSUFBOEM7QUFBYSxRQUF0RCxTQUFTLENBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO0FBQUMsd0RBQThCO0FBRTVFLElBQTZCO0FBQWEsUUFBckMsZUFBZSxDQUFDLE1BQU0sQ0FBQztBQUFDLHNEQUEyQjtBQUV4RCxJQTVCYSxpQkFBaUIsd0JBSjdCLFNBQVMsQ0FBQyxjQUNQLGpDQUdJLENBK0JDLFdBQUEsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBO09BbENqQixFQUFFLFdBQVcscEJBbUN6QixPQWhDYSxpQkFBaUIsQ0ErRjdCO09BakdHOzs7Ozs7OzJDQUF5QztRQUM1QyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQWlHRjtBQUFDLElBREQsd0JBQUM7QUFDQSxDQURBLEFBL0ZELElBK0ZDO0FBQ0QsU0FoR2EsaUJBQWlCO0FBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIENvbXBvbmVudCwgT25Jbml0LCBJbmplY3QsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBWaWV3Q2hpbGQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBDaGFuZ2VEZXRlY3RvclJlZlxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgRm9ybUdyb3VwIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBDcnVkU2VydmljZSwgQ1JVRF9TRVJWSUNFIH0gZnJvbSBcIi4vY3J1ZC1zZXJ2aWNlLnNlcnZpY2VcIjtcbmltcG9ydCB7IFJvdXRlciwgQWN0aXZhdGVkUm91dGUgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBDb2x1bW4gfSBmcm9tICcuLi9kYXRhdGFibGUvcC1jb2x1bW4uZGlyZWN0aXZlJztcbmltcG9ydCB7IERhdGF0YWJsZUNvbXBvbmVudCB9IGZyb20gJy4uL2RhdGF0YWJsZS9kYXRhdGFibGUuY29tcG9uZW50J1xuaW1wb3J0IHsgRGF0YXRhYmxlQ2xpY2tFdmVudCB9IGZyb20gJy4uL2RhdGF0YWJsZS9kYXRhdGFibGUtY2xpY2stZXZlbnQnXG5cbmltcG9ydCB7IENvbmZpcm1hdGlvblNlcnZpY2UgfSBmcm9tICdwcmltZW5nL2FwaSc7XG5pbXBvcnQgeyBVcmwgfSBmcm9tICd1cmwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25DcnVkTGlzdCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NydWQtbGlzdC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQ3J1ZExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQge1xuXG4gICAgQElucHV0KCkgZm9ybTogRm9ybUdyb3VwO1xuXG4gICAgQElucHV0KCkgYWN0aW9uOiBzdHJpbmcgPSBcImZpbmRBbGxcIjtcblxuICAgIEBJbnB1dCgpIGZpbmRMYWJlbDogc3RyaW5nID0gXCJQZXNxdWlzYXJcIjtcblxuICAgIEBJbnB1dCgpIHNlcnZpY2U6IENydWRTZXJ2aWNlPGFueSwgYW55PjtcblxuICAgIEBJbnB1dCgpIHVybDogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgZGlzYWJsZVNhdmUgPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpIGRpc2FibGVFZGl0ID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKSBkaXNhYmxlVmlldyA9IGZhbHNlO1xuXG4gICAgQElucHV0KCkgZGlzYWJsZURlbGV0ZSA9IGZhbHNlO1xuXG4gICAgQElucHV0KCkgZGF0YXRhYmxlRXh0cmFQYXJhbXM6IGFueTtcblxuICAgIEBPdXRwdXQoKSBmaW5kOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQFZpZXdDaGlsZCgnZGF0YXRhYmxlJywgeyBzdGF0aWM6IHRydWUgfSkgZGF0YXRhYmxlOiBEYXRhdGFibGVDb21wb25lbnQ7XG5cbiAgICBAQ29udGVudENoaWxkcmVuKENvbHVtbikgY29sdW1uczogUXVlcnlMaXN0PENvbHVtbj47XG5cbiAgICByZXN1bHQ6IGFueVtdO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBJbmplY3QoQ1JVRF9TRVJWSUNFKVxuICAgICAgICBwdWJsaWMgY3J1ZFNlcnZpY2U6IENydWRTZXJ2aWNlPGFueSwgYW55PixcbiAgICAgICAgcHJpdmF0ZSBjb25maXJtYXRpb25TZXJ2aWNlOiBDb25maXJtYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlclxuICAgICkgeyAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRoaXMuY3J1ZFNlcnZpY2UgPSB0aGlzLnNlcnZpY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnVybCkge1xuICAgICAgICAgICAgdGhpcy51cmwgPSB0aGlzLmNydWRTZXJ2aWNlLnVyaVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGF0YXRhYmxlQ2xpY2soZXZlbnQ6IERhdGF0YWJsZUNsaWNrRXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LnNlbGVjdGlvbikge1xuICAgICAgICAgICAgc3dpdGNoIChldmVudC5idXR0b24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZWRpdFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJ2aWV3XCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtgLi4vJHtldmVudC5idXR0b259YCwgZXZlbnQuc2VsZWN0aW9uLmlkXSwgeyByZWxhdGl2ZVRvOiB0aGlzLnJvdXRlIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGVsZXRlXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlybWF0aW9uU2VydmljZS5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdWb2PDqiB0ZW0gY2VydGV6YSBxdWUgZGVzZWphIGV4Y2x1aXIgbyByZWdpc3Rybz8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0OiAoKSA9PiB0aGlzLmNydWRTZXJ2aWNlLmRlbGV0ZShldmVudC5zZWxlY3Rpb24uaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmRhdGF0YWJsZS5maWx0ZXIoKSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZmluZEFsbChldmVudDogYW55KSB7XG4gICAgICAgIGlmICh0aGlzLmZpbmQub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5maW5kLmVtaXQodGhpcy5mb3JtLnZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YXRhYmxlLmZpbHRlclBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5mb3JtLnZhbHVlKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZm9ybS52YWx1ZVtlbGVtZW50XTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhdGFibGUuZmlsdGVyUGFyYW1zW2VsZW1lbnRdID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKS5yZXBsYWNlKC9cIi9nLCBcIlwiKSA6IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5kYXRhdGFibGUuZmlsdGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIGNvbnN0IGRhdGF0YWJsZU5nQWZ0ZXJDb250ZW50SW5pdCA9IHRoaXMuZGF0YXRhYmxlLnBEYXRhdGFibGVDb21wb25lbnQubmdBZnRlckNvbnRlbnRJbml0O1xuICAgICAgICB0aGlzLmRhdGF0YWJsZS5wRGF0YXRhYmxlQ29tcG9uZW50Lm5nQWZ0ZXJDb250ZW50SW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YXRhYmxlLnBEYXRhdGFibGVDb21wb25lbnQuY29sdW1ucyA9IHRoaXMuY29sdW1ucy50b0FycmF5KCk7XG4gICAgICAgICAgICBkYXRhdGFibGVOZ0FmdGVyQ29udGVudEluaXQuY2FsbCh0aGlzLmRhdGF0YWJsZS5wRGF0YXRhYmxlQ29tcG9uZW50KTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5kYXRhdGFibGVFeHRyYVBhcmFtcykge1xuICAgICAgICAgICAgdGhpcy5kYXRhdGFibGVbaV0gPSB0aGlzLmRhdGF0YWJsZUV4dHJhUGFyYW1zW2ldO1xuICAgICAgICB9XG4gICAgfVxuXG59XG4iXX0=