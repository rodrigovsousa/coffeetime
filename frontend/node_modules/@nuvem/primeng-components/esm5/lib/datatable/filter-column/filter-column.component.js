import { __decorate } from "tslib";
import { Component, EventEmitter, Output, Input } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@angular/forms';
import * as ɵngcc3 from 'primeng';

function FilterColumn_div_1_Template(rf, ctx) { if (rf & 1) {
    var _r925 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "div", 2);
    ɵngcc0.ɵɵelementStart(2, "div", 3);
    ɵngcc0.ɵɵelementStart(3, "span", 4);
    ɵngcc0.ɵɵelementStart(4, "input", 5);
    ɵngcc0.ɵɵlistener("input", function FilterColumn_div_1_Template_input_input_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r925); var ctx_r924 = ɵngcc0.ɵɵnextContext(); return ctx_r924.filtrar($event); })("ngModelChange", function FilterColumn_div_1_Template_input_ngModelChange_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r925); var ctx_r926 = ɵngcc0.ɵɵnextContext(); return ctx_r926.filtro = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "label");
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r922 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r922.filtro);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r922.header ? ctx_r922.header : "Filtro");
} }
var _c0 = function () { return { "width": "100%" }; };
var _c1 = function () { return { standalone: true }; };
function FilterColumn_div_2_Template(rf, ctx) { if (rf & 1) {
    var _r928 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "p-multiSelect", 6);
    ɵngcc0.ɵɵlistener("onChange", function FilterColumn_div_2_Template_p_multiSelect_onChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r928); var ctx_r927 = ɵngcc0.ɵɵnextContext(); return ctx_r927.filtrar($event); })("ngModelChange", function FilterColumn_div_2_Template_p_multiSelect_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r928); var ctx_r929 = ɵngcc0.ɵɵnextContext(); return ctx_r929.filtro = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r923 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵstyleMap(ɵngcc0.ɵɵpureFunction0(7, _c0));
    ɵngcc0.ɵɵproperty("options", ctx_r923.getCustomFilterOptions())("defaultLabel", ctx_r923.header ? ctx_r923.header : "\u00A0")("optionLabel", "label")("ngModelOptions", ɵngcc0.ɵɵpureFunction0(8, _c1))("ngModel", ctx_r923.filtro);
} }
var FilterColumn = /** @class */ (function () {
    function FilterColumn() {
        this.listaOriginal = [];
        this.lista = [];
        this.labelDefaultImplementation = false;
        this.updateFiltro = false;
        this.customFilterOptions = {};
        this.template = 'filter_text';
        this.outputEvent = new EventEmitter();
        this.debouncer = new Subject();
        this.resultado = [];
        this.listaFields = [];
    }
    FilterColumn.prototype.ngOnInit = function () {
        var _this = this;
        this.debouncer
            .pipe(debounceTime((this.tableType === 'memory') ? 300 : 1000))
            .subscribe(function (value) { return _this.outputEvent.emit(value); });
        this.template = "filter_" + this.filterType;
    };
    FilterColumn.prototype.ngOnChanges = function (changes) {
        if (this.checkChanges(changes, 'listaOriginal')) {
            this.preencherFields();
        }
    };
    FilterColumn.prototype.checkChanges = function (changes, property) {
        return changes[property] && changes[property].previousValue != changes[property].currentValue;
    };
    /**
     * Método para propagar o evento de filtragem
     * @param event filtro
     */
    FilterColumn.prototype.filtrar = function (event) {
        this.debouncer.next(this.filtro);
    };
    /**
     * Preenche os itens que serão exibidos no multiselect, removendo duplicidades
     */
    FilterColumn.prototype.preencherFields = function () {
        var _this = this;
        this.listaFields = [];
        this.listaOriginal.filter(function (pi) { return pi[_this.field] !== null; }).forEach(function (row) {
            var item = { label: row[_this.field], value: row[_this.field] };
            if (!_this.verificarSeExisteField(item)) {
                _this.listaFields.push(item);
            }
        });
    };
    /**
     *
     * @param field Verifica duplicidade de fields nas opções de seleção
     */
    FilterColumn.prototype.verificarSeExisteField = function (field) {
        return this.listaFields.some(function (item) {
            return item.value == field.value;
        });
    };
    /**
     * Caso o usuaŕio não forneça uma lista para o options, será criada uma lista com
     * os valores presentes na tabela
     */
    FilterColumn.prototype.getCustomFilterOptions = function () {
        if (this.customFilterOptions.hasOwnProperty(this.field)) {
            return this.customFilterOptions[this.field];
        }
        return this.listaFields;
    };
    __decorate([
        Input()
    ], FilterColumn.prototype, "listaOriginal", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "lista", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "field", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "header", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "labelDefaultImplementation", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "labelDefaultName", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "updateFiltro", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "filterType", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "tableType", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "customFilterOptions", void 0);
    __decorate([
        Input()
    ], FilterColumn.prototype, "template", void 0);
    __decorate([
        Output()
    ], FilterColumn.prototype, "outputEvent", void 0);
FilterColumn.ɵfac = function FilterColumn_Factory(t) { return new (t || FilterColumn)(); };
FilterColumn.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FilterColumn, selectors: [["basis-filter-column"]], inputs: { listaOriginal: "listaOriginal", lista: "lista", labelDefaultImplementation: "labelDefaultImplementation", updateFiltro: "updateFiltro", customFilterOptions: "customFilterOptions", template: "template", field: "field", header: "header", labelDefaultName: "labelDefaultName", filterType: "filterType", tableType: "tableType" }, outputs: { outputEvent: "outputEvent" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 3, vars: 3, consts: [[3, "ngSwitch"], [4, "ngSwitchCase"], [1, "ui-g", "form-group"], [1, "ui-md-12"], [1, "md-inputfield"], ["type", "text", "pInputText", "", 3, "ngModel", "input", "ngModelChange"], ["appendTo", "body", 3, "options", "defaultLabel", "optionLabel", "ngModelOptions", "ngModel", "onChange", "ngModelChange"]], template: function FilterColumn_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, FilterColumn_div_1_Template, 7, 2, "div", 1);
        ɵngcc0.ɵɵtemplate(2, FilterColumn_div_2_Template, 2, 9, "div", 1);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngSwitch", ctx.filterType);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", "text");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", "select");
    } }, directives: [ɵngcc1.NgSwitch, ɵngcc1.NgSwitchCase, ɵngcc2.DefaultValueAccessor, ɵngcc3.InputText, ɵngcc2.NgControlStatus, ɵngcc2.NgModel, ɵngcc3.MultiSelect], encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FilterColumn, [{
        type: Component,
        args: [{
                selector: 'basis-filter-column',
                template: "<div [ngSwitch]=\"filterType\">\n    <div *ngSwitchCase=\"'text'\">\n        <div class=\"ui-g form-group\">\n            <div class=\"ui-md-12\">\n                <span class=\"md-inputfield\">\n                    <input type=\"text\" pInputText (input)=\"filtrar($event)\" [(ngModel)]=\"filtro\">\n                    <label>{{ (header) ? header : 'Filtro' }}</label>\n                </span>\n            </div>\n        </div>\n    </div>\n    <div *ngSwitchCase=\"'select'\">\n        <p-multiSelect\n            [options]=\"getCustomFilterOptions()\"\n            [defaultLabel]=\"(header)? header: '&nbsp;'\"\n            [optionLabel]=\"'label'\"\n            appendTo=\"body\"\n            [ngModelOptions]=\"{standalone: true}\"\n            (onChange)=\"filtrar($event)\"\n            [(ngModel)]=\"filtro\"\n            [style]=\"{'width':'100%'}\">\n        </p-multiSelect>\n    </div>\n</div>\n"
            }]
    }], function () { return []; }, { listaOriginal: [{
            type: Input
        }], lista: [{
            type: Input
        }], labelDefaultImplementation: [{
            type: Input
        }], updateFiltro: [{
            type: Input
        }], customFilterOptions: [{
            type: Input
        }], template: [{
            type: Input
        }], outputEvent: [{
            type: Output
        }], field: [{
            type: Input
        }], header: [{
            type: Input
        }], labelDefaultName: [{
            type: Input
        }], filterType: [{
            type: Input
        }], tableType: [{
            type: Input
        }] }); })();
    return FilterColumn;
}());
export { FilterColumn };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWNvbHVtbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIm5nOi9AbnV2ZW0vcHJpbWVuZy1jb21wb25lbnRzL2xpYi9kYXRhdGFibGUvZmlsdGVyLWNvbHVtbi9maWx0ZXItY29sdW1uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBbUMsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTTlDO0FBQWdELElBa0M1QztBQUVHLFFBbENNLGtCQUFhLEdBQVUsRUFBRSxDQUFDO0FBQ3ZDLFFBQ2EsVUFBSyxHQUFVLEVBQUUsQ0FBQztBQUMvQixRQUthLCtCQUEwQixHQUFZLEtBQUssQ0FBQztBQUN6RCxRQUdhLGlCQUFZLEdBQVksS0FBSyxDQUFDO0FBQzNDLFFBS2Esd0JBQW1CLEdBQVcsRUFBRSxDQUFDO0FBQzlDLFFBQ2EsYUFBUSxHQUFHLGFBQWEsQ0FBQztBQUN0QyxRQUNjLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUMvQyxRQUNZLGNBQVMsR0FBaUIsSUFBSSxPQUFPLEVBQU8sQ0FBQztBQUN6RCxRQUdJLGNBQVMsR0FBVSxFQUFFLENBQUM7QUFDMUIsUUFDWSxnQkFBVyxHQUFVLEVBQUUsQ0FBQztBQUNwQyxJQUNvQixDQUFDO0FBQ3JCLElBQ0ksK0JBQVEsR0FBUjtBQUNILFFBREcsaUJBTUM7QUFDTCxRQU5RLElBQUksQ0FBQyxTQUFTO0FBQ3RCLGFBQWEsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxDQUFDLENBQUEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxD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YztBQUUzQixJQUFhO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsZ0RBQWU7QUFFNUIsSUFBYTtBQUFhLFFBQXJCLEtBQUssRUFBRTtBQUFDLG9FQUE0QztBQUV6RCxJQUFhO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsMERBQXlCO0FBRXRDLElBQWE7QUFBYSxRQUFyQixLQUFLLEVBQUU7QUFBQyxzREFBOEI7QUFFM0MsSUFBYTtBQUFhLFFBQXJCLEtBQUssRUFBRTtBQUFDLG9EQUFtQjtBQUVoQyxJQUFhO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsbURBQWtCO0FBRS9CLElBQWE7QUFBYSxRQUFyQixLQUFLLEVBQUU7QUFBQyw2REFBaUM7QUFFOUMsSUFBYTtBQUFhLFFBQXJCLEtBQUssRUFBRTtBQUFDLGtEQUF5QjtBQUV0QyxJQUFjO0FBQWEsUUFBdEIsTUFBTSxFQUFFO0FBQUMscURBQWlDO0lBeEJsQyxZQUFZLHdCQUp4QixTQUFTLENBQUMsY0FDUCxRQUFRLEVBQUU7R0FBcUIsY0FDL0I7Z0JBQTZDLFVBQ2hELENBQUMsUUFDVztHQUFZLENBaUd4Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFDRDtBQUFDLElBREQsbUJBQUM7QUFDQSxDQURBLEFBakdELElBaUdDO0FBQ0QsU0FsR2EsWUFBWTtBQUFJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSW5wdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlLCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdiYXNpcy1maWx0ZXItY29sdW1uJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZmlsdGVyLWNvbHVtbi5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRmlsdGVyQ29sdW1uIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQge1xuXG4gICAgQElucHV0KCkgbGlzdGFPcmlnaW5hbDogYW55W10gPSBbXTtcblxuICAgIEBJbnB1dCgpIGxpc3RhOiBhbnlbXSA9IFtdO1xuXG4gICAgQElucHV0KCkgZmllbGQ6IHN0cmluZztcblxuICAgIEBJbnB1dCgpIGhlYWRlcjogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgbGFiZWxEZWZhdWx0SW1wbGVtZW50YXRpb246IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpIGxhYmVsRGVmYXVsdE5hbWU6IHN0cmluZztcblxuICAgIEBJbnB1dCgpIHVwZGF0ZUZpbHRybzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KCkgZmlsdGVyVHlwZTogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgdGFibGVUeXBlOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSBjdXN0b21GaWx0ZXJPcHRpb25zOiBPYmplY3QgPSB7fTtcblxuICAgIEBJbnB1dCgpIHRlbXBsYXRlID0gJ2ZpbHRlcl90ZXh0JztcblxuICAgIEBPdXRwdXQoKSBvdXRwdXRFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIHByaXZhdGUgZGVib3VuY2VyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XG5cbiAgICBmaWx0cm86IGFueTtcblxuICAgIHJlc3VsdGFkbzogYW55W10gPSBbXTtcblxuICAgIHByaXZhdGUgbGlzdGFGaWVsZHM6IGFueVtdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuZGVib3VuY2VyXG4gICAgICAgICAgICAucGlwZShkZWJvdW5jZVRpbWUoKHRoaXMudGFibGVUeXBlID09PSAnbWVtb3J5Jyk/IDMwMCA6IDEwMDApKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgodmFsdWUpID0+IHRoaXMub3V0cHV0RXZlbnQuZW1pdCh2YWx1ZSkpO1xuXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBgZmlsdGVyXyR7dGhpcy5maWx0ZXJUeXBlfWA7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogeyBbcHJvcE5hbWU6IHN0cmluZ106IFNpbXBsZUNoYW5nZSB9KSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrQ2hhbmdlcyhjaGFuZ2VzLCAnbGlzdGFPcmlnaW5hbCcpKSB7XG4gICAgICAgICAgICB0aGlzLnByZWVuY2hlckZpZWxkcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2hlY2tDaGFuZ2VzKGNoYW5nZXM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBTaW1wbGVDaGFuZ2UgfSwgcHJvcGVydHkpIHtcbiAgICAgICAgcmV0dXJuIGNoYW5nZXNbcHJvcGVydHldICYmIGNoYW5nZXNbcHJvcGVydHldLnByZXZpb3VzVmFsdWUgIT0gY2hhbmdlc1twcm9wZXJ0eV0uY3VycmVudFZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE3DqXRvZG8gcGFyYSBwcm9wYWdhciBvIGV2ZW50byBkZSBmaWx0cmFnZW1cbiAgICAgKiBAcGFyYW0gZXZlbnQgZmlsdHJvXG4gICAgICovXG4gICAgZmlsdHJhcihldmVudCkge1xuICAgICAgICB0aGlzLmRlYm91bmNlci5uZXh0KHRoaXMuZmlsdHJvKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmVlbmNoZSBvcyBpdGVucyBxdWUgc2Vyw6NvIGV4aWJpZG9zIG5vIG11bHRpc2VsZWN0LCByZW1vdmVuZG8gZHVwbGljaWRhZGVzXG4gICAgICovXG4gICAgcHJlZW5jaGVyRmllbGRzKCkge1xuICAgICAgICB0aGlzLmxpc3RhRmllbGRzID0gW107XG4gICAgICAgIHRoaXMubGlzdGFPcmlnaW5hbC5maWx0ZXIocGkgPT4gcGlbdGhpcy5maWVsZF0gIT09IG51bGwpLmZvckVhY2gocm93ID0+IHtcbiAgICAgICAgICAgIGxldCBpdGVtID0ge2xhYmVsOiByb3dbdGhpcy5maWVsZF0sIHZhbHVlOiByb3dbdGhpcy5maWVsZF19O1xuICAgICAgICAgICAgaWYgKCF0aGlzLnZlcmlmaWNhclNlRXhpc3RlRmllbGQoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RhRmllbGRzLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkIFZlcmlmaWNhIGR1cGxpY2lkYWRlIGRlIGZpZWxkcyBuYXMgb3DDp8O1ZXMgZGUgc2VsZcOnw6NvXG4gICAgICovXG4gICAgdmVyaWZpY2FyU2VFeGlzdGVGaWVsZChmaWVsZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0YUZpZWxkcy5zb21lKGl0ZW0gPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT0gZmllbGQudmFsdWU7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhc28gbyB1c3VhxZVpbyBuw6NvIGZvcm5lw6dhIHVtYSBsaXN0YSBwYXJhIG8gb3B0aW9ucywgc2Vyw6EgY3JpYWRhIHVtYSBsaXN0YSBjb21cbiAgICAgKiBvcyB2YWxvcmVzIHByZXNlbnRlcyBuYSB0YWJlbGFcbiAgICAgKi9cbiAgICBnZXRDdXN0b21GaWx0ZXJPcHRpb25zKCkge1xuICAgICAgICBpZiAodGhpcy5jdXN0b21GaWx0ZXJPcHRpb25zLmhhc093blByb3BlcnR5KHRoaXMuZmllbGQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXN0b21GaWx0ZXJPcHRpb25zW3RoaXMuZmllbGRdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGFGaWVsZHM7XG4gICAgfVxuXG59XG4iXX0=