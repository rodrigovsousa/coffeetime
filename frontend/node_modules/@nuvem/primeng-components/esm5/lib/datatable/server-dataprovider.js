/**
 * Class ServerDataProvider
 * @class
 */
var ServerDataProvider = /** @class */ (function () {
    /**
     * constructor method
     * @constructor
     * @param {DatatableService} datatableService
     * @param {DatatableComponent} component
     */
    function ServerDataProvider(datatableService, component) {
        var _this = this;
        this.datatableService = datatableService;
        this.component = component;
        this.component.pDatatableComponent.onLazyLoad.subscribe(function (event) { return _this.onLazyLoad(event); });
        this.component.pDatatableComponent.lazy = true;
    }
    /**
     * onLazyLoad method
     * @param {LazyLoadEvent} onLazyLoad
     * @returns void
     */
    ServerDataProvider.prototype.onLazyLoad = function (event) {
        this.currentLazyLoadEvent = event;
        this.load();
    };
    /**
     * load method
     * @param {any} query
     * @returns void
     */
    ServerDataProvider.prototype.load = function (query) {
        var _this = this;
        query = this.retrieveAndSaveQuery(query);
        this.component.startedLoading.emit();
        this.datatableService.search(this.currentLazyLoadEvent, this.component.url, this.component.pDatatableComponent.rows, this.component.orderInSort, query)
            .toPromise()
            .then(function (response) {
            _this.treatLoadResponse(response);
            _this.component.finishedLoading.emit();
        }, function (error) {
            _this.component.finishedLoading.emit(error);
        });
    };
    /**
     * treatLoadResponse method
     * @param {any} response
     * @return void
     */
    ServerDataProvider.prototype.treatLoadResponse = function (response) {
        var data = response.body;
        if (this.component.paginationParameters) {
            this.treatLoadResponseWithPaginationParameters(data);
        }
        else {
            this.treatLoadResponseWithoutPaginationParameters(response, data);
        }
    };
    /**
     * treatLoadResponseWithPaginationParameters method
     * @param {any} data
     * @returns void
     */
    ServerDataProvider.prototype.treatLoadResponseWithPaginationParameters = function (data) {
        var contentIndex = this.component.paginationParameters.contentIndex;
        var totalIndex = this.component.paginationParameters.totalElementsIndex;
        this.component.value = (data[contentIndex]) ? data[contentIndex] : data;
        this.component.pDatatableComponent.totalRecords = (data[totalIndex]) ? data[totalIndex] : this.component.value.length;
    };
    /**
     * treatLoadResponseWithoutPaginationParameters method
     * @param {any} response
     * @param {any} data
     * @returns void
     */
    ServerDataProvider.prototype.treatLoadResponseWithoutPaginationParameters = function (response, data) {
        if (response.headers.has('x-total-count')) {
            this.component.pDatatableComponent.totalRecords = parseInt(response.headers.get('x-total-count'), 10);
            this.component.value = data;
        }
        else {
            this.component.pDatatableComponent.totalRecords = data.totalElements;
            this.component.value = data.content;
        }
    };
    /**
     * retrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    ServerDataProvider.prototype.retrieveAndSaveQuery = function (query) {
        var oldQuery = this._query;
        var currentQuery = this.doRetrieveAndSaveQuery(query);
        this.resetToFirstPageIfQueryChanged(oldQuery, currentQuery);
        return currentQuery;
    };
    /**
     * doRetrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    ServerDataProvider.prototype.doRetrieveAndSaveQuery = function (query) {
        if ('object' === typeof query && query.value) {
            this._query = query.value;
        }
        else if (query) {
            this._query = query;
        }
        return this._query;
    };
    /**
     * resetToFirstPageIfQueryChanged method
     * @param {any} oldQuery
     * @param {any} currentQuery
     * @returns void
     */
    ServerDataProvider.prototype.resetToFirstPageIfQueryChanged = function (oldQuery, currentQuery) {
        if (oldQuery !== currentQuery) {
            this.currentLazyLoadEvent.first = 0;
            this.component.pDatatableComponent.first = 0;
        }
    };
    /**
     * reset method
     * @returns void
     */
    ServerDataProvider.prototype.reset = function () {
        this._query = undefined;
    };
    return ServerDataProvider;
}());
export { ServerDataProvider };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLWRhdGFwcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BudXZlbS9wcmltZW5nLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvZGF0YXRhYmxlL3NlcnZlci1kYXRhcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBS0E7OztHQUdHO0FBQ0g7SUFjSTs7Ozs7T0FLRztJQUNILDRCQUFvQixnQkFBa0MsRUFBVSxTQUE2QjtRQUE3RixpQkFHQztRQUhtQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBb0I7UUFDekYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLFVBQUMsS0FBb0IsSUFBSyxPQUFBLEtBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQXRCLENBQXNCLENBQUMsQ0FBQztRQUMxRyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCx1Q0FBVSxHQUFWLFVBQVcsS0FBb0I7UUFDM0IsSUFBSSxDQUFDLG9CQUFvQixHQUFHLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxpQ0FBSSxHQUFKLFVBQUssS0FBVztRQUFoQixpQkFtQkM7UUFsQkcsS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUN4QixJQUFJLENBQUMsb0JBQW9CLEVBQ3pCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUNsQixJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLElB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LENBQUMsS0FBSyxDQUFDO1NBQzdCO2FBQU0sSUFBSSxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztTQUN2QjtRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSywyREFBOEIsR0FBdEMsVUFBdUMsUUFBUSxFQUFFLFlBQVk7UUFDekQsSUFBSSxRQUFRLEtBQUssWUFBWSxFQUFFO1lBQzNCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztTQUNoRDtJQUNMLENBQUM7SUFDRDs7O09BR0c7SUFDSCxrQ0FBSyxHQUFMO1FBQ0ksSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7SUFDNUIsQ0FBQztJQUNMLHlCQUFDO0FBQUQsQ0FBQyxBQXBKRCxJQW9KQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExhenlMb2FkRXZlbnQgfSBmcm9tICdwcmltZW5nJztcbmltcG9ydCB7IERhdGF0YWJsZUNvbXBvbmVudCB9IGZyb20gJy4vZGF0YXRhYmxlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEYXRhdGFibGVTZXJ2aWNlIH0gZnJvbSAnLi9kYXRhdGFibGUuc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhUHJvdmlkZXIgfSBmcm9tICcuL2RhdGFwcm92aWRlcic7XG5cbi8qKlxuICogQ2xhc3MgU2VydmVyRGF0YVByb3ZpZGVyXG4gKiBAY2xhc3NcbiAqL1xuZXhwb3J0IGNsYXNzIFNlcnZlckRhdGFQcm92aWRlciBpbXBsZW1lbnRzIERhdGFQcm92aWRlciB7XG5cbiAgICAvKipcbiAgICAgKiBjdXJyZW50TGF6eUxvYWRFdmVudCBwcm9wZXJ0eVxuICAgICAqIEB0eXBlIHtMYXp5TG9hZEV2ZW50fVxuICAgICAqL1xuICAgIGN1cnJlbnRMYXp5TG9hZEV2ZW50OiBMYXp5TG9hZEV2ZW50O1xuXG4gICAgLyoqXG4gICAgICogX3F1ZXJ5IHByb3BlcnR5XG4gICAgICogQHR5cGUge2FueX1cbiAgICAgKi9cbiAgICBwcml2YXRlIF9xdWVyeTogYW55O1xuXG4gICAgLyoqXG4gICAgICogY29uc3RydWN0b3IgbWV0aG9kXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtEYXRhdGFibGVTZXJ2aWNlfSBkYXRhdGFibGVTZXJ2aWNlXG4gICAgICogQHBhcmFtIHtEYXRhdGFibGVDb21wb25lbnR9IGNvbXBvbmVudFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YXRhYmxlU2VydmljZTogRGF0YXRhYmxlU2VydmljZSwgcHJpdmF0ZSBjb21wb25lbnQ6IERhdGF0YWJsZUNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50Lm9uTGF6eUxvYWQuc3Vic2NyaWJlKChldmVudDogTGF6eUxvYWRFdmVudCkgPT4gdGhpcy5vbkxhenlMb2FkKGV2ZW50KSk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQubGF6eSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogb25MYXp5TG9hZCBtZXRob2RcbiAgICAgKiBAcGFyYW0ge0xhenlMb2FkRXZlbnR9IG9uTGF6eUxvYWRcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgb25MYXp5TG9hZChldmVudDogTGF6eUxvYWRFdmVudCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRMYXp5TG9hZEV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGxvYWQgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHF1ZXJ5XG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIGxvYWQocXVlcnk/OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgcXVlcnkgPSB0aGlzLnJldHJpZXZlQW5kU2F2ZVF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5jb21wb25lbnQuc3RhcnRlZExvYWRpbmcuZW1pdCgpO1xuICAgICAgICB0aGlzLmRhdGF0YWJsZVNlcnZpY2Uuc2VhcmNoKFxuICAgICAgICAgICAgdGhpcy5jdXJyZW50TGF6eUxvYWRFdmVudCxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnVybCxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQucm93cyxcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lm9yZGVySW5Tb3J0LFxuICAgICAgICAgICAgcXVlcnkpXG4gICAgICAgICAgICAudG9Qcm9taXNlKClcbiAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmVhdExvYWRSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuZmluaXNoZWRMb2FkaW5nLmVtaXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5maW5pc2hlZExvYWRpbmcuZW1pdChlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdHJlYXRMb2FkUmVzcG9uc2UgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHJlc3BvbnNlXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgcHJpdmF0ZSB0cmVhdExvYWRSZXNwb25zZShyZXNwb25zZTogYW55KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5ib2R5O1xuICAgICAgICBpZiAodGhpcy5jb21wb25lbnQucGFnaW5hdGlvblBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMudHJlYXRMb2FkUmVzcG9uc2VXaXRoUGFnaW5hdGlvblBhcmFtZXRlcnMoZGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRyZWF0TG9hZFJlc3BvbnNlV2l0aG91dFBhZ2luYXRpb25QYXJhbWV0ZXJzKHJlc3BvbnNlLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHRyZWF0TG9hZFJlc3BvbnNlV2l0aFBhZ2luYXRpb25QYXJhbWV0ZXJzIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7YW55fSBkYXRhXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHByaXZhdGUgdHJlYXRMb2FkUmVzcG9uc2VXaXRoUGFnaW5hdGlvblBhcmFtZXRlcnMoZGF0YSkge1xuICAgICAgICBsZXQgY29udGVudEluZGV4ID0gdGhpcy5jb21wb25lbnQucGFnaW5hdGlvblBhcmFtZXRlcnMuY29udGVudEluZGV4O1xuICAgICAgICBsZXQgdG90YWxJbmRleCA9IHRoaXMuY29tcG9uZW50LnBhZ2luYXRpb25QYXJhbWV0ZXJzLnRvdGFsRWxlbWVudHNJbmRleDtcbiAgICAgICAgdGhpcy5jb21wb25lbnQudmFsdWUgPSAoZGF0YVtjb250ZW50SW5kZXhdKT8gZGF0YVtjb250ZW50SW5kZXhdOiBkYXRhO1xuICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50LnRvdGFsUmVjb3JkcyA9IChkYXRhW3RvdGFsSW5kZXhdKT8gZGF0YVt0b3RhbEluZGV4XTogdGhpcy5jb21wb25lbnQudmFsdWUubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHRyZWF0TG9hZFJlc3BvbnNlV2l0aG91dFBhZ2luYXRpb25QYXJhbWV0ZXJzIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7YW55fSByZXNwb25zZVxuICAgICAqIEBwYXJhbSB7YW55fSBkYXRhXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHByaXZhdGUgdHJlYXRMb2FkUmVzcG9uc2VXaXRob3V0UGFnaW5hdGlvblBhcmFtZXRlcnMocmVzcG9uc2U6IGFueSwgZGF0YSkge1xuICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVycy5oYXMoJ3gtdG90YWwtY291bnQnKSkge1xuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQucERhdGF0YWJsZUNvbXBvbmVudC50b3RhbFJlY29yZHMgPSBwYXJzZUludChyZXNwb25zZS5oZWFkZXJzLmdldCgneC10b3RhbC1jb3VudCcpLCAxMCk7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC52YWx1ZSA9IGRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50LnRvdGFsUmVjb3JkcyA9IGRhdGEudG90YWxFbGVtZW50cztcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnZhbHVlID0gZGF0YS5jb250ZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmV0cmlldmVBbmRTYXZlUXVlcnkgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHF1ZXJ5XG4gICAgICogQHJldHVybnMgYW55XG4gICAgICovXG4gICAgcHJpdmF0ZSByZXRyaWV2ZUFuZFNhdmVRdWVyeShxdWVyeTogYW55KTogYW55IHtcbiAgICAgICAgY29uc3Qgb2xkUXVlcnkgPSB0aGlzLl9xdWVyeTtcbiAgICAgICAgY29uc3QgY3VycmVudFF1ZXJ5ID0gdGhpcy5kb1JldHJpZXZlQW5kU2F2ZVF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5yZXNldFRvRmlyc3RQYWdlSWZRdWVyeUNoYW5nZWQob2xkUXVlcnksIGN1cnJlbnRRdWVyeSk7XG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlcnk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZG9SZXRyaWV2ZUFuZFNhdmVRdWVyeSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gcXVlcnlcbiAgICAgKiBAcmV0dXJucyBhbnlcbiAgICAgKi9cbiAgICBwcml2YXRlIGRvUmV0cmlldmVBbmRTYXZlUXVlcnkocXVlcnk6IGFueSk6IGFueSB7XG4gICAgICAgIGlmICgnb2JqZWN0JyA9PT0gdHlwZW9mIHF1ZXJ5ICYmIHF1ZXJ5LnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9xdWVyeSA9IHF1ZXJ5LnZhbHVlO1xuICAgICAgICB9IGVsc2UgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgICB0aGlzLl9xdWVyeSA9IHF1ZXJ5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZXNldFRvRmlyc3RQYWdlSWZRdWVyeUNoYW5nZWQgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IG9sZFF1ZXJ5XG4gICAgICogQHBhcmFtIHthbnl9IGN1cnJlbnRRdWVyeVxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc2V0VG9GaXJzdFBhZ2VJZlF1ZXJ5Q2hhbmdlZChvbGRRdWVyeSwgY3VycmVudFF1ZXJ5KSB7XG4gICAgICAgIGlmIChvbGRRdWVyeSAhPT0gY3VycmVudFF1ZXJ5KSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMYXp5TG9hZEV2ZW50LmZpcnN0ID0gMDtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQuZmlyc3QgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJlc2V0IG1ldGhvZFxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5fcXVlcnkgPSB1bmRlZmluZWQ7XG4gICAgfVxufVxuIl19